<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Butterfly Tracker</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;user-select:none;-webkit-user-select:none;-webkit-tap-highlight-color:transparent}
html,body{width:100%;height:100%;overflow:hidden;font-family:'Nunito','Segoe UI',sans-serif;background:#87CEEB;touch-action:none}

#gameContainer{position:fixed;inset:0;width:100%;height:100%}
#gameCanvas{display:block;width:100%;height:100%;background:linear-gradient(180deg,#87CEEB 0%,#E0F6FF 100%)}
#trailCanvas{position:absolute;inset:0;width:100%;height:100%;pointer-events:none}

.ui-wrapper{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:10}

.ui-top{display:flex;justify-content:space-between;align-items:center;padding:16px 30px;pointer-events:auto}
.stat-item{background:rgba(255,255,255,.85);padding:16px 28px;border-radius:16px;border:3px solid #FFD700;box-shadow:0 4px 12px rgba(0,0,0,.15);font-weight:800}
.stat-label{font-size:12px;color:#666;text-transform:uppercase;letter-spacing:1px}
.stat-value{font-size:42px;color:#FF6B9D;margin-top:4px}

.butterflies-caught{color:#FF1493;font-size:14px;margin-top:4px}
.combo-meter-container{
  background:rgba(255,255,255,.85);
  padding:12px 20px;border-radius:14px;border:3px solid #FFD700;
  min-width:150px;
}
.combo-meter-label{font-size:11px;color:#666;text-transform:uppercase;letter-spacing:1px;font-weight:700}
.combo-meter{
  width:100%;height:8px;background:#ddd;border-radius:4px;margin-top:6px;overflow:hidden
}
.combo-meter-bar{height:100%;background:linear-gradient(90deg,#FF6B9D,#FFD700);width:100%;transition:width .3s}

.catch-feedback{position:fixed;pointer-events:none;font-size:48px;font-weight:900;text-shadow:2px 2px 8px rgba(0,0,0,.3);animation:catchPop .8s ease-out forwards;z-index:50}
@keyframes catchPop{0%{opacity:1;transform:translate(-50%,-50%) scale(0.5)}50%{opacity:1;transform:translate(-50%,-50%) scale(1.3)}100%{opacity:0;transform:translate(-50%,-50%) translateY(-60px) scale(0.8)}}

.menu-btn{position:fixed;bottom:30px;right:30px;background:linear-gradient(135deg,#FF1493,#FF69B4);color:white;border:none;padding:18px 36px;font-size:18px;font-weight:800;border-radius:50px;cursor:pointer;box-shadow:0 6px 20px rgba(255,20,147,.3);transition:all .3s;z-index:100;pointer-events:auto;touch-action:manipulation}
.menu-btn:hover{transform:scale(1.08);box-shadow:0 8px 28px rgba(255,20,147,.4)}
.menu-btn:active{transform:scale(0.92)}

.game-over-overlay{position:fixed;inset:0;background:rgba(0,0,0,.75);backdrop-filter:blur(8px);display:none;align-items:center;justify-content:center;z-index:200;pointer-events:none}
.game-over-overlay.show{display:flex;pointer-events:auto}
.game-over-box{background:linear-gradient(135deg,#FFE0F0,#FFF0F8);padding:60px 80px;border-radius:32px;text-align:center;border:5px solid #FF1493;box-shadow:0 20px 60px rgba(0,0,0,.3)}
.game-over-box h1{font-size:54px;color:#FF1493;margin-bottom:20px}
.game-over-stats{margin:20px 0;font-size:26px;color:#666;font-weight:700}
.go-btn{padding:20px 50px;margin-top:30px;font-size:20px;font-weight:800;border:none;border-radius:50px;cursor:pointer;transition:all .3s;color:white;margin-right:15px;pointer-events:auto;touch-action:manipulation;-webkit-tap-highlight-color:transparent}
.go-btn.play{background:linear-gradient(135deg,#4CAF50,#45a049);box-shadow:0 6px 20px rgba(76,175,80,.3)}
.go-btn.menu{background:linear-gradient(135deg,#2196F3,#1976D2);box-shadow:0 6px 20px rgba(33,150,243,.3)}
.go-btn:hover{transform:scale(1.08)}
.go-btn:active{transform:scale(0.92)}

.difficulty-selector{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:linear-gradient(135deg,#FFE0F0,#FFF0F8);padding:50px 60px;border-radius:28px;border:4px solid #FF1493;text-align:center;z-index:150;pointer-events:auto;box-shadow:0 20px 60px rgba(0,0,0,.3)}
.difficulty-selector h2{font-size:36px;color:#FF1493;margin-bottom:30px;font-weight:900}
.difficulty-options{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin-bottom:30px}
.difficulty-btn{padding:20px 30px;background:linear-gradient(135deg,#FFB6D9,#FF69B4);color:white;border:3px solid white;border-radius:16px;font-size:18px;font-weight:800;cursor:pointer;transition:all .3s;touch-action:manipulation}
.difficulty-btn:hover{transform:scale(1.08);box-shadow:0 6px 20px rgba(255,20,147,.3)}
.difficulty-btn:active{transform:scale(0.92)}
.difficulty-btn.selected{background:linear-gradient(135deg,#FF1493,#FF006B);box-shadow:0 0 20px rgba(255,20,147,.5)}
</style>
</head>
<body>

<div id="gameContainer">
  <canvas id="gameCanvas"></canvas>
  <canvas id="trailCanvas"></canvas>
</div>

<div class="ui-wrapper">
  <div class="ui-top">
    <div>
      <div class="stat-item">
        <div class="stat-label">Butterflies Caught</div>
        <div class="stat-value" id="scoreDisplay">0</div>
      </div>
    </div>
    <div>
      <div class="stat-item">
        <div class="stat-label">Time Left</div>
        <div class="stat-value" id="timerDisplay">60s</div>
      </div>
    </div>
    <div class="combo-meter-container">
      <div class="combo-meter-label">Combo Streak</div>
      <div class="combo-meter">
        <div class="combo-meter-bar" id="comboBar"></div>
      </div>
      <div style="font-size:18px;font-weight:900;color:#FF1493;margin-top:6px" id="comboCount">0x</div>
    </div>
  </div>
</div>

<button class="menu-btn" id="menuBtn">‚Üê Back to Menu</button>

<div class="difficulty-selector" id="difficultySelector">
  <h2>Select Difficulty</h2>
  <div class="difficulty-options">
    <button class="difficulty-btn" data-difficulty="easy">ü¶ã Easy<br>(8 Butterflies)</button>
    <button class="difficulty-btn selected" data-difficulty="normal">ü¶ãü¶ã Normal<br>(12 Butterflies)</button>
    <button class="difficulty-btn" data-difficulty="hard">ü¶ãü¶ãü¶ã Hard<br>(18 Butterflies)</button>
  </div>
  <button class="go-btn play" id="startGameBtn">Start Game!</button>
</div>

<div class="game-over-overlay" id="gameOverOverlay">
  <div class="game-over-box">
    <h1>Game Over!</h1>
    <div class="game-over-stats">
      <div>ü¶ã Butterflies Caught: <span id="finalScore">0</span></div>
      <div style="margin-top:12px;font-size:20px;color:#999">Best Combo: <span id="finalCombo">0</span>x</div>
    </div>
    <div>
      <button class="go-btn play" id="playAgainBtn">Play Again</button>
      <button class="go-btn menu" id="menuFromGameOverBtn">Main Menu</button>
    </div>
  </div>
</div>

<script>
class Butterfly {
  constructor(x, y) {
    this.x = x;
    this.y = y;
    this.size = 22 + Math.random() * 8;
    this.speed = 1.2 + Math.random() * 1.5;
    this.angle = Math.random() * Math.PI * 2;
    this.wing = 0;
    this.color = ['#ff4fa3','#ff6fb1','#ff9ad5','#d98bff'][Math.floor(Math.random()*4)];
    this.trail = [];
    this.caught = false;
  }

  update(canvas, fingers) {
    if (this.caught) return;

    // React to fingers (chase / evade)
    fingers.forEach(f => {
      const dx = this.x - f.x;
      const dy = this.y - f.y;
      const dist = Math.hypot(dx, dy);
      if (dist < 120) {
        this.angle += Math.atan2(dy, dx) * 0.015;
      }
    });

    // Natural wandering
    this.angle += (Math.random() - 0.5) * 0.15;
    this.x += Math.cos(this.angle) * this.speed;
    this.y += Math.sin(this.angle) * this.speed;

    // Bounds
    this.x = Math.max(20, Math.min(canvas.width - 20, this.x));
    this.y = Math.max(20, Math.min(canvas.height - 20, this.y));

    // Wing motion
    this.wing += 0.25;

    // Dotted trail
    this.trail.push({x:this.x,y:this.y,life:15});
    if (this.trail.length > 30) this.trail.shift();
    this.trail.forEach(p => p.life--);
    this.trail = this.trail.filter(p => p.life > 0);
  }

  draw(ctx) {
    // Trail (dotted)
    this.trail.forEach(p => {
      ctx.globalAlpha = p.life / 15;
      ctx.fillStyle = this.color;
      ctx.beginPath();
      ctx.arc(p.x, p.y, 2, 0, Math.PI*2);
      ctx.fill();
    });
    ctx.globalAlpha = 1;

    ctx.save();
    ctx.translate(this.x, this.y);
    ctx.scale(0.3, 0.3);

    const flap = Math.sin(this.wing) * 15;

    // Upper right wing
    ctx.fillStyle = this.color;
    ctx.beginPath();
    ctx.moveTo(100, 100);
    ctx.bezierCurveTo(180 + flap, 20, 220 + flap, 120, 100, 130);
    ctx.closePath();
    ctx.fill();

    // Lower right wing
    ctx.fillStyle = this.color;
    ctx.globalAlpha = 0.85;
    ctx.beginPath();
    ctx.moveTo(100, 130);
    ctx.bezierCurveTo(160 + flap, 140, 160 + flap, 180, 100, 160);
    ctx.closePath();
    ctx.fill();

    // Upper left wing
    ctx.globalAlpha = 1;
    ctx.fillStyle = this.color;
    ctx.beginPath();
    ctx.moveTo(100, 100);
    ctx.bezierCurveTo(20 - flap, 20, -20 - flap, 120, 100, 130);
    ctx.closePath();
    ctx.fill();

    // Lower left wing
    ctx.fillStyle = this.color;
    ctx.globalAlpha = 0.85;
    ctx.beginPath();
    ctx.moveTo(100, 130);
    ctx.bezierCurveTo(40 - flap, 140, 40 - flap, 180, 100, 160);
    ctx.closePath();
    ctx.fill();

    // Body
    ctx.globalAlpha = 1;
    ctx.fillStyle = '#333';
    ctx.beginPath();
    ctx.ellipse(100, 130, 6, 35, 0, 0, Math.PI*2);
    ctx.fill();

    // Left antenna
    ctx.strokeStyle = '#333';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(98, 100);
    ctx.quadraticCurveTo(90, 70, 80, 75);
    ctx.stroke();

    // Right antenna
    ctx.beginPath();
    ctx.moveTo(102, 100);
    ctx.quadraticCurveTo(110, 70, 120, 75);
    ctx.stroke();

    ctx.restore();
  }

  hit(x,y){
    return Math.hypot(this.x-x,this.y-y) < this.size;
  }
}

class GardenGame {
  constructor(){
    this.canvas = document.getElementById('gameCanvas');
    this.ctx = this.canvas.getContext('2d');
    this.resize();
    window.addEventListener('resize',()=>this.resize());

    this.butterflies=[];
    this.fingers=[];
    this.score=0;

    for(let i=0;i<14;i++) this.spawn();

    this.bind();
    this.loop();
  }

  resize(){
    this.canvas.width=innerWidth;
    this.canvas.height=innerHeight;
  }

  spawn(){
    this.butterflies.push(
      new Butterfly(
        Math.random()*this.canvas.width,
        Math.random()*this.canvas.height*0.7
      )
    );
  }

  bind(){
    this.canvas.addEventListener('touchstart',e=>{
      [...e.touches].forEach(t=>this.catch(t.clientX,t.clientY));
    });

    this.canvas.addEventListener('touchmove',e=>{
      this.fingers=[...e.touches].map(t=>({x:t.clientX,y:t.clientY}));
      [...e.touches].forEach(t=>this.catch(t.clientX,t.clientY));
    });

    this.canvas.addEventListener('touchend',()=>this.fingers=[]);

    this.canvas.addEventListener('mousemove',e=>{
      this.fingers=[{x:e.clientX,y:e.clientY}];
      this.catch(e.clientX,e.clientY);
    });
  }

  catch(x,y){
    this.butterflies.forEach(b=>{
      if(!b.caught && b.hit(x,y)){
        b.caught=true;
        this.score++;
        this.spawn();
      }
    });
  }

  drawGarden(){
    // Sky
    let g=this.ctx.createLinearGradient(0,0,0,this.canvas.height);
    g.addColorStop(0,'#87ceeb');
    g.addColorStop(1,'#6fcf97');
    this.ctx.fillStyle=g;
    this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);

    // Grass
    this.ctx.fillStyle='#3fa34d';
    this.ctx.fillRect(0,this.canvas.height*0.75,this.canvas.width,this.canvas.height);

    // Flowers
    for(let i=0;i<40;i++){
      this.ctx.fillStyle=['#ff4f81','#ffd93d','#b983ff'][i%3];
      this.ctx.beginPath();
      this.ctx.arc(Math.random()*this.canvas.width,
                   this.canvas.height*0.75+Math.random()*100,
                   4,0,Math.PI*2);
      this.ctx.fill();
    }
  }

  loop(){
    this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);
    this.drawGarden();

    this.butterflies.forEach(b=>{
      b.update(this.canvas,this.fingers);
      b.draw(this.ctx);
    });

    requestAnimationFrame(()=>this.loop());
  }
}

new GardenGame();
</script>


</body>
</html>
