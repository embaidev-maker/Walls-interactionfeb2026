<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fish Catcher - Underwater Adventure</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
        }
        
        body {
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(180deg, #0a2463 0%, #1e3c8b 30%, #2a5298 100%);
            color: white;
            height: 100vh;
            width: 100vw;
            position: relative;
            touch-action: none;
        }
        
        /* Underwater Environment */
        .bubbles {
            position: absolute;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
        }
        
        .bubble {
            position: absolute;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            animation: floatUp 15s infinite linear;
        }
        
        @keyframes floatUp {
            0% {
                transform: translateY(100vh) translateX(0);
                opacity: 0;
            }
            10% {
                opacity: 0.5;
            }
            90% {
                opacity: 0.5;
            }
            100% {
                transform: translateY(-100px) translateX(20px);
                opacity: 0;
            }
        }
        
        .seaweed {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 150px;
            background: linear-gradient(to top, rgba(0, 100, 0, 0.7), transparent);
            z-index: 2;
            pointer-events: none;
        }
        
        /* Game UI */
        .game-ui {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 50;
        }
        
        .ui-top {
            width: 100%;
            pointer-events: none;
            z-index: 10;
        }
        
        .stats {
            display: flex;
            justify-content: space-between;
            padding: 20px 40px;
        }
        
        .stat-item {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px 30px;
            border-radius: 20px;
            backdrop-filter: blur(8px);
            border: 2px solid rgba(255, 255, 255, 0.15);
            min-width: 180px;
        }
        
        .stat-label {
            font-size: 14px;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.6);
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }
        
        .stat-value {
            font-size: 36px;
            font-weight: 700;
            color: #4fc3f7;
            text-shadow: 0 0 10px rgba(79, 195, 247, 0.5);
        }
        
        .timer {
            color: #ffd700;
        }
        
        .lives {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .heart {
            font-size: 32px;
            filter: drop-shadow(1px 1px 3px rgba(0, 0, 0, 0.5));
            transition: all 0.3s;
            color: #ff6b6b;
        }
        
        /* Start Screen */
        .start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(10, 36, 99, 0.85);
            backdrop-filter: blur(5px);
            z-index: 200;
            pointer-events: auto;
        }
        
        .start-title {
            font-size: 72px;
            font-weight: 900;
            color: #4fc3f7;
            text-shadow: 0 0 20px rgba(79, 195, 247, 0.7);
            margin-bottom: 30px;
            text-align: center;
        }
        
        .start-subtitle {
            font-size: 24px;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 60px;
            text-align: center;
            max-width: 800px;
            line-height: 1.5;
        }
        
        .start-btn {
            padding: 25px 80px;
            font-size: 32px;
            font-weight: 700;
            background: linear-gradient(135deg, #4fc3f7, #0288d1);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            pointer-events: auto;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            animation: pulse 2s ease-in-out infinite;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .start-btn:active {
            transform: scale(0.95);
        }
        
        .instructions {
            position: absolute;
            bottom: 100px;
            width: 100%;
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 18px;
            pointer-events: none;
        }
        
        /* Game Over Screen */
        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.92);
            padding: 50px 70px;
            border-radius: 24px;
            text-align: center;
            border: 4px solid #4fc3f7;
            box-shadow: 0 0 40px rgba(79, 195, 247, 0.4);
            display: none;
            z-index: 300;
            pointer-events: auto;
            width: 90%;
            max-width: 700px;
        }
        
        .game-over.show {
            display: block;
        }
        
        .game-over h1 {
            font-size: 52px;
            color: #ff6b6b;
            margin-bottom: 16px;
        }
        
        .final-score {
            font-size: 40px;
            color: #4fc3f7;
            margin: 16px 0;
        }
        
        .high-score {
            font-size: 28px;
            color: #ffd700;
            margin-bottom: 30px;
        }
        
        .go-btn {
            margin-top: 20px;
            padding: 18px 50px;
            font-size: 22px;
            font-weight: 700;
            background: linear-gradient(135deg, #4fc3f7, #0288d1);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            pointer-events: auto;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        
        .go-btn:active {
            transform: scale(0.95);
        }
        
        .go-btn + .go-btn {
            margin-left: 12px;
            background: linear-gradient(135deg, #3498db, #2980b9);
        }
        
        /* Game Area */
        .game-area {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        /* Catch Effect */
        .catch-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 150;
            display: none;
        }
        
        .catch-effect.active {
            display: block;
            animation: catchFlash 0.5s ease-out forwards;
        }
        
        @keyframes catchFlash {
            0% { background: rgba(79, 195, 247, 0.2); }
            100% { background: rgba(79, 195, 247, 0); }
        }
        
        /* Combo Display */
        .combo-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 72px;
            font-weight: 900;
            color: #4fc3f7;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.7);
            pointer-events: none;
            z-index: 20;
            animation: comboAnim 1s ease-out forwards;
        }
        
        @keyframes comboAnim {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            40% { opacity: 1; transform: translate(-50%, -50%) scale(1.4); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1) translateY(-80px); }
        }
        
        /* Fish Styles - Based on provided CSS */
        :root {
            --coilSize: 14px;
            --delayCount: 40ms;
            --scaleMe: 1;
            --scaleFlip: 1;
            --posFlip: 0;
        }
        
        .fish-container {
            position: absolute;
            cursor: pointer;
            transition: transform 0.2s;
            z-index: 10;
            pointer-events: auto;
            filter: drop-shadow(
                calc(var(--coilSize) * 4) calc(var(--coilSize) / 3) 5px rgba(0, 0, 0, 0.3)
            );
        }
        
        .fish-container.caught {
            animation: caughtAnimation 0.8s forwards;
        }
        
        @keyframes caughtAnimation {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(0); opacity: 0; }
        }
        
        .fish {
            position: relative;
            width: 100%;
            height: 100%;
        }
        
        .fish .koiCoil {
            position: absolute;
            width: var(--coilSize);
            height: var(--coilSize);
            background-color: orangered;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            margin-left: calc(var(--coilSize) / -2);
            margin-top: calc(var(--coilSize) / -2);
            transform: scale(var(--scaleMe), var(--scaleMe));
            filter: contrast(200%);
            offset-path: path(
                "M11.7692 229.5C14.552 200.052 7.51901 171.858 -42.8757 170.644C-105.869 169.128 -131.294 76.612 -101.695 51.5872C-72.0955 26.5625 -24.6607 -50.7867 70.5883 51.5872C165.837 153.961 27.7073 131.211 33.0199 183.157C38.3326 235.102 90.3211 195.669 139.274 223.727C188.226 251.785 207.959 299.56 139.274 316.243C70.5883 332.926 41.3685 398.9 81.9726 419.754C122.577 440.608 222 478.524 222 419.754C222 372.738 222 242.432 222 183.157C219.091 129.948 175.78 30.8091 25.8099 59.9288C-161.652 96.3284 -30.3529 119.837 25.8099 141.07C81.9726 162.303 171.529 204.769 126.751 260.506C81.9726 316.243 101.326 362.501 139.274 373.496C177.222 384.492 170.012 464.495 70.5883 462.979C-28.835 461.462 -42.8757 393.015 -42.8757 373.496C-42.8757 238.288 11.7692 293 11.7692 240.506C11.7692 208.05 11.7692 237.336 11.7692 229.5Z"
            );
            animation: fishAnim 20000ms linear infinite;
            box-shadow: calc(var(--coilSize) / -2) calc(var(--coilSize) / -10) 0 white
                inset;
        }
        
        .fish-container:nth-of-type(odd) .fish {
            transform-origin: top center;
            transform: scale(-1, 1);
            filter: drop-shadow(
                calc(var(--coilSize) * -4) calc(var(--coilSize) / 3) 5px rgba(0, 0, 0, 0.3)
            );
        }
        
        .fish-container:nth-of-type(odd) .koiCoil {
            background-color: white;
            box-shadow: calc(var(--coilSize) / -2) calc(var(--coilSize) / -10) 0 orangered
                inset;
        }
        
        .fish .koiCoil:nth-of-type(15),
        .fish .koiCoil:nth-of-type(14) {
            background-color: orangered;
        }
        
        .fish-container:nth-of-type(odd) .koiCoil:nth-of-type(15),
        .fish-container:nth-of-type(odd) .koiCoil:nth-of-type(14) {
            background-color: white;
        }
        
        .fish .koiCoil:nth-of-type(15)::after {
            content: ":";
            position: absolute;
            color: black;
            font-weight: 800;
            text-align: center;
            line-height: 60%;
            font-size: calc(var(--coilSize) * 1.2);
        }
        
        .fish .koiCoil:nth-of-type(1)::before {
            content: "";
            position: absolute;
            width: 100%;
            height: 50%;
            top: 25%;
            left: -100%;
            border-radius: var(--coilSize);
            background-color: white;
            transform-origin: center right;
            animation: backFlip 200ms ease-in-out alternate infinite;
        }
        
        .fish .koiCoil:nth-of-type(14) {
            --scaleMe: 1.2;
            animation-delay: calc(var(--delayCount) * 1);
        }
        
        .fish .koiCoil:nth-of-type(13) {
            --scaleMe: 1.35;
            animation-delay: calc(var(--delayCount) * 2);
        }
        
        .fish .koiCoil:nth-of-type(12) {
            --scaleMe: 1.55;
            animation-delay: calc(var(--delayCount) * 3);
        }
        
        .fish .koiCoil:nth-of-type(11) {
            --scaleMe: 1.75;
            animation-delay: calc(var(--delayCount) * 4);
        }
        
        .fish .koiCoil:nth-of-type(10) {
            --scaleMe: 1.9;
            animation-delay: calc(var(--delayCount) * 5);
        }
        
        .fish .koiCoil:nth-of-type(9) {
            --scaleMe: 2;
            animation-delay: calc(var(--delayCount) * 6);
        }
        
        .fish .koiCoil:nth-of-type(8) {
            --scaleMe: 2;
            animation-delay: calc(var(--delayCount) * 7);
        }
        
        .fish .koiCoil:nth-of-type(7) {
            --scaleMe: 2;
            animation-delay: calc(var(--delayCount) * 8);
        }
        
        .fish .koiCoil:nth-of-type(6) {
            --scaleMe: 1.9;
            animation-delay: calc(var(--delayCount) * 9);
        }
        
        .fish .koiCoil:nth-of-type(5) {
            --scaleMe: 1.75;
            animation-delay: calc(var(--delayCount) * 10);
        }
        
        .fish .koiCoil:nth-of-type(4) {
            --scaleMe: 1.55;
            animation-delay: calc(var(--delayCount) * 11);
        }
        
        .fish .koiCoil:nth-of-type(3) {
            --scaleMe: 1.35;
            animation-delay: calc(var(--delayCount) * 12);
        }
        
        .fish .koiCoil:nth-of-type(2) {
            --scaleMe: 1.2;
            animation-delay: calc(var(--delayCount) * 13);
        }
        
        .fish .koiCoil:nth-of-type(1) {
            animation-delay: calc(var(--delayCount) * 14);
        }
        
        .fish .koiCoil:nth-of-type(12)::before,
        .fish .koiCoil:nth-of-type(12)::after {
            content: "";
            position: absolute;
            width: 100%;
            height: 20%;
            top: -10%;
            left: -100%;
            border-radius: var(--coilSize);
            background-color: white;
            transform-origin: center right;
            animation: sideFlip 500ms ease-in-out alternate infinite;
        }
        
        .fish .koiCoil:nth-of-type(12)::after {
            --scaleFlip: -1;
            --posFlip: calc(var(--coilSize) * -1);
        }
        
        @keyframes fishAnim {
            0% {
                offset-distance: 0%;
            }
            100% {
                offset-distance: 100%;
            }
        }
        
        @keyframes backFlip {
            0% {
                transform: rotate(45deg);
            }
            100% {
                transform: rotate(-45deg);
            }
        }
        
        @keyframes sideFlip {
            0% {
                transform: scale(1, var(--scaleFlip)) translateY(var(--posFlip))rotate(80deg);
            }
            100% {
                transform: scale(1, var(--scaleFlip)) translateY(var(--posFlip))rotate(20deg);
            }
        }
        
        /* Points Display */
        .points-display {
            position: absolute;
            font-size: 32px;
            font-weight: 900;
            color: #4fc3f7;
            text-shadow: 0 0 10px rgba(79, 195, 247, 0.8);
            pointer-events: none;
            z-index: 100;
            animation: pointsFloat 1s ease-out forwards;
        }
        
        @keyframes pointsFloat {
            0% {
                opacity: 1;
                transform: translate(-50%, -50%) translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) translateY(-80px) scale(0.8);
            }
        }
        
        /* Coral Reef Decorations */
        .coral {
            position: absolute;
            bottom: 0;
            width: 60px;
            height: 150px;
            background: linear-gradient(to top, #ff6b6b, #ff8e53);
            border-radius: 30px 30px 0 0;
            z-index: 2;
            pointer-events: none;
        }
        
        .coral:nth-child(1) {
            left: 10%;
            height: 120px;
            background: linear-gradient(to top, #ff6b6b, #ff8e53);
        }
        
        .coral:nth-child(2) {
            left: 25%;
            height: 180px;
            background: linear-gradient(to top, #4fc3f7, #2196f3);
            width: 40px;
        }
        
        .coral:nth-child(3) {
            right: 15%;
            height: 140px;
            background: linear-gradient(to top, #66bb6a, #43a047);
            width: 50px;
        }
        
        .coral:nth-child(4) {
            right: 30%;
            height: 100px;
            background: linear-gradient(to top, #ba68c8, #ab47bc);
            width: 35px;
        }
        
        /* Treasure Chest */
        .treasure {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 60px;
            background: linear-gradient(to top, #ffd700, #ffab00);
            border-radius: 10px 10px 0 0;
            z-index: 2;
            pointer-events: none;
            box-shadow: 0 -5px 15px rgba(255, 215, 0, 0.3);
        }
        
        .treasure::before {
            content: "üí∞";
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 30px;
            filter: drop-shadow(0 5px 5px rgba(0, 0, 0, 0.3));
        }
    </style>
</head>
<body>
    <!-- Underwater Environment -->
    <div class="bubbles" id="bubbles"></div>
    <div class="seaweed"></div>
    <div class="coral"></div>
    <div class="coral"></div>
    <div class="coral"></div>
    <div class="coral"></div>
    <div class="treasure"></div>
    
    <!-- Game Area -->
    <div class="game-area" id="gameArea"></div>
    
    <!-- Start Screen -->
    <div class="start-screen" id="startScreen">
        <h1 class="start-title">üê† Fish Catcher üê†</h1>
        <p class="start-subtitle">Catch as many colorful koi fish as you can in 60 seconds! Tap or click on fish to catch them. Each fish is worth points based on its color.</p>
        <button class="start-btn" id="startBtn">
            <i class="fas fa-play"></i> START GAME
        </button>
        <div class="instructions">
            <p>Underwater Adventure | Multi-touch Supported</p>
        </div>
    </div>
    
    <!-- Game UI -->
    <div class="game-ui">
        <div class="ui-top">
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-label">Score</div>
                    <div class="stat-value" id="scoreDisplay">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Time</div>
                    <div class="stat-value timer" id="timerDisplay">60</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Lives</div>
                    <div class="lives" id="livesDisplay">
                        <span class="heart">‚ù§Ô∏è</span>
                        <span class="heart">‚ù§Ô∏è</span>
                        <span class="heart">‚ù§Ô∏è</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Catch Effect -->
    <div class="catch-effect" id="catchEffect"></div>
    
    <!-- Game Over Screen -->
    <div class="game-over" id="gameOver">
        <h1>GAME OVER!</h1>
        <div class="final-score">Score: <span id="finalScore">0</span></div>
        <div class="high-score" id="highScore">High Score: 0</div>
        <div>
            <button class="go-btn" id="playAgainBtn">Play Again</button>
            <button class="go-btn" id="menuBtn">Main Menu</button>
        </div>
    </div>

    <script>
        // Game variables
        let score = 0;
        let lives = 3;
        let timeLeft = 60;
        let gameRunning = false;
        let gameStarted = false;
        let fishes = [];
        let combo = 0;
        let comboTimer = 0;
        let highScore = localStorage.getItem('fishHighScore') || 0;
        let spawnTimer = null;
        let clockTimer = null;
        
        // Fish colors and types
        const fishTypes = [
            { name: 'orange', color: 'orangered', points: 10, shadow: 'orangered' },
            { name: 'white', color: 'white', points: 15, shadow: 'white' },
            { name: 'gold', color: '#ffd700', points: 20, shadow: '#ffd700' },
            { name: 'blue', color: '#4fc3f7', points: 12, shadow: '#4fc3f7' },
            { name: 'purple', color: '#ba68c8', points: 18, shadow: '#ba68c8' }
        ];
        
        // DOM elements
        const gameArea = document.getElementById('gameArea');
        const startScreen = document.getElementById('startScreen');
        const startBtn = document.getElementById('startBtn');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const timerDisplay = document.getElementById('timerDisplay');
        const livesDisplay = document.getElementById('livesDisplay');
        const gameOverScreen = document.getElementById('gameOver');
        const finalScoreElement = document.getElementById('finalScore');
        const highScoreElement = document.getElementById('highScore');
        const playAgainBtn = document.getElementById('playAgainBtn');
        const menuBtn = document.getElementById('menuBtn');
        const catchEffect = document.getElementById('catchEffect');
        const bubblesContainer = document.getElementById('bubbles');
        
        // Initialize high score display
        highScoreElement.textContent = `High Score: ${highScore}`;
        
        // Create bubbles
        function createBubbles() {
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const bubble = document.createElement('div');
                    bubble.className = 'bubble';
                    const size = Math.random() * 30 + 10;
                    bubble.style.width = `${size}px`;
                    bubble.style.height = `${size}px`;
                    bubble.style.left = `${Math.random() * 100}%`;
                    bubble.style.animationDuration = `${Math.random() * 10 + 10}s`;
                    bubble.style.animationDelay = `${Math.random() * 5}s`;
                    bubblesContainer.appendChild(bubble);
                    
                    // Remove bubble after animation
                    setTimeout(() => {
                        if (bubble.parentNode) {
                            bubble.remove();
                        }
                    }, 20000);
                }, i * 500);
            }
        }
        
        // Start creating bubbles
        createBubbles();
        setInterval(createBubbles, 20000);
        
        // Start game function
        function startGame() {
            gameStarted = true;
            gameRunning = true;
            
            // Hide start screen
            startScreen.style.display = 'none';
            
            // Reset game variables
            score = 0;
            lives = 3;
            timeLeft = 60;
            fishes = [];
            combo = 0;
            
            // Update UI
            updateScore();
            updateTimer();
            updateLives();
            
            // Start game timers
            spawnTimer = setInterval(spawnFish, 1200);
            clockTimer = setInterval(updateGameClock, 1000);
            
            // Create initial fish
            for (let i = 0; i < 5; i++) {
                setTimeout(() => spawnFish(), i * 500);
            }
        }
        
        // Spawn a fish
        function spawnFish() {
            if (!gameRunning) return;
            
            const fishContainer = document.createElement('div');
            fishContainer.className = 'fish-container';
            
            // Random position (spawn from edges)
            const side = Math.floor(Math.random() * 3); // 0: left, 1: top, 2: right
            
            let x, y;
            if (side === 0) { // Left side
                x = -200;
                y = Math.random() * (window.innerHeight - 200) + 100;
            } else if (side === 1) { // Top
                x = Math.random() * (window.innerWidth - 200) + 100;
                y = -200;
            } else { // Right side
                x = window.innerWidth + 200;
                y = Math.random() * (window.innerHeight - 200) + 100;
            }
            
            fishContainer.style.left = `${x}px`;
            fishContainer.style.top = `${y}px`;
            
            // Random size
            const size = Math.random() * 0.8 + 0.5;
            fishContainer.style.transform = `scale(${size})`;
            
            // Random fish type
            const fishType = fishTypes[Math.floor(Math.random() * fishTypes.length)];
            
            // Create fish HTML structure
            fishContainer.innerHTML = `
                <div class="fish">
                    ${Array(15).fill('<div class="koiCoil"></div>').join('')}
                </div>
            `;
            
            // Apply fish color
            const koiCoils = fishContainer.querySelectorAll('.koiCoil');
            koiCoils.forEach(coil => {
                if (coil.style.backgroundColor !== 'orangered' && coil.style.backgroundColor !== 'white') {
                    coil.style.backgroundColor = fishType.color;
                }
            });
            
            // Add event listeners for catching
            fishContainer.addEventListener('click', catchFish);
            fishContainer.addEventListener('touchstart', catchFish, { passive: true });
            
            // Add to game area
            gameArea.appendChild(fishContainer);
            
            // Random movement pattern
            const targetX = Math.random() * (window.innerWidth - 200) + 100;
            const targetY = Math.random() * (window.innerHeight - 200) + 100;
            const speed = Math.random() * 1.5 + 0.5;
            
            fishes.push({
                element: fishContainer,
                x: x,
                y: y,
                targetX: targetX,
                targetY: targetY,
                speed: speed,
                type: fishType,
                direction: Math.random() > 0.5 ? 1 : -1,
                wobblePhase: Math.random() * Math.PI * 2,
                wobbleSpeed: Math.random() * 0.02 + 0.01,
                wobbleAmount: Math.random() * 30 + 20,
                time: 0
            });
            
            // Remove fish after some time if not caught
            setTimeout(() => {
                if (fishContainer.parentNode && gameRunning) {
                    fishContainer.remove();
                    fishes = fishes.filter(f => f.element !== fishContainer);
                    
                    // Lose a life if fish escapes
                    if (lives > 0) {
                        lives--;
                        updateLives();
                        
                        if (lives <= 0) {
                            endGame();
                        }
                    }
                }
            }, 20000);
        }
        
        // Catch fish
        function catchFish(event) {
            if (!gameRunning) return;
            
            event.preventDefault();
            event.stopPropagation();
            
            const fishElement = event.currentTarget;
            const fish = fishes.find(f => f.element === fishElement);
            
            if (!fish) return;
            
            // Get click position
            const rect = fishElement.getBoundingClientRect();
            const clickX = rect.left + rect.width / 2;
            const clickY = rect.top + rect.height / 2;
            
            // Add caught animation
            fishElement.classList.add('caught');
            
            // Update score with combo
            combo++;
            comboTimer = 60;
            const points = fish.type.points + (combo >= 3 ? combo * 3 : 0);
            score += points;
            
            // Play pop sound
            playBubbleSound();
            
            // Show points display
            const pointsDisplay = document.createElement('div');
            pointsDisplay.className = 'points-display';
            pointsDisplay.textContent = `+${points}`;
            pointsDisplay.style.left = `${clickX}px`;
            pointsDisplay.style.top = `${clickY}px`;
            document.body.appendChild(pointsDisplay);
            
            setTimeout(() => {
                pointsDisplay.remove();
            }, 1000);
            
            // Show combo if applicable
            if (combo >= 3) {
                showCombo(combo);
            }
            
            // Update UI
            updateScore();
            
            // Show catch effect
            catchEffect.classList.add('active');
            setTimeout(() => {
                catchEffect.classList.remove('active');
            }, 500);
            
            // Create bubble particles
            createBubbleParticles(clickX, clickY, fish.type.color);
            
            // Remove from arrays
            fishes = fishes.filter(f => f.element !== fishElement);
            
            // Remove from DOM after animation
            setTimeout(() => {
                if (fishElement.parentNode) {
                    fishElement.remove();
                }
            }, 800);
        }
        
        // Create bubble particles
        function createBubbleParticles(x, y, color) {
            for (let i = 0; i < 15; i++) {
                const bubble = document.createElement('div');
                bubble.className = 'bubble';
                const size = Math.random() * 20 + 5;
                bubble.style.width = `${size}px`;
                bubble.style.height = `${size}px`;
                bubble.style.left = `${x}px`;
                bubble.style.top = `${y}px`;
                bubble.style.backgroundColor = color;
                bubble.style.animation = `floatUp ${Math.random() * 2 + 1}s ease-out forwards`;
                bubble.style.position = 'fixed';
                bubble.style.zIndex = '5';
                document.body.appendChild(bubble);
                
                setTimeout(() => {
                    if (bubble.parentNode) {
                        bubble.remove();
                    }
                }, 2000);
            }
        }
        
        // Play bubble sound effect
        function playBubbleSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(50, audioContext.currentTime + 0.2);
                
                gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.2);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.2);
            } catch (e) {
                console.log('Audio context not available');
            }
        }
        
        // Show combo display
        function showCombo(comboCount) {
            const comboDisplay = document.createElement('div');
            comboDisplay.className = 'combo-display';
            comboDisplay.textContent = `${comboCount}x COMBO!`;
            comboDisplay.style.left = `${Math.random() * 60 + 20}%`;
            document.body.appendChild(comboDisplay);
            
            setTimeout(() => {
                comboDisplay.remove();
            }, 1000);
        }
        
        // Update game clock
        function updateGameClock() {
            if (!gameRunning) {
                clearInterval(clockTimer);
                return;
            }
            
            timeLeft--;
            updateTimer();
            
            if (timeLeft <= 10) {
                timerDisplay.style.color = '#ff6b6b';
            }
            
            if (timeLeft <= 0) {
                endGame();
            }
            
            // Update combo timer
            if (comboTimer > 0) {
                comboTimer--;
                if (comboTimer === 0) {
                    combo = 0;
                }
            }
        }
        
        // Update score display
        function updateScore() {
            scoreDisplay.textContent = score;
        }
        
        // Update timer display
        function updateTimer() {
            timerDisplay.textContent = timeLeft;
        }
        
        // Update lives display
        function updateLives() {
            livesDisplay.innerHTML = '';
            for (let i = 0; i < 3; i++) {
                const heart = document.createElement('span');
                heart.className = 'heart';
                heart.textContent = i < lives ? '‚ù§Ô∏è' : 'ü§ç';
                livesDisplay.appendChild(heart);
            }
        }
        
        // End game
        function endGame() {
            gameRunning = false;
            
            // Clear timers
            if (spawnTimer) {
                clearInterval(spawnTimer);
                spawnTimer = null;
            }
            if (clockTimer) {
                clearInterval(clockTimer);
                clockTimer = null;
            }
            
            // Remove all fish
            fishes.forEach(fish => {
                if (fish.element.parentNode) {
                    fish.element.remove();
                }
            });
            fishes = [];
            
            // Update final score
            finalScoreElement.textContent = score;
            
            // Update high score if needed
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('fishHighScore', highScore);
                highScoreElement.innerHTML = `<i class="fas fa-trophy"></i> New High Score: ${highScore}`;
                highScoreElement.style.color = '#ffd700';
            } else {
                highScoreElement.textContent = `High Score: ${highScore}`;
                highScoreElement.style.color = '#4fc3f7';
            }
            
            // Show game over screen
            gameOverScreen.classList.add('show');
        }
        
        // Restart game
        function restartGame() {
            gameOverScreen.classList.remove('show');
            startGame();
        }
        
        // Return to menu
        function returnToMenu() {
            window.location.href = '/index.html';
        }
        
        // Fish movement animation
        function animateFish() {
            if (!gameRunning) {
                requestAnimationFrame(animateFish);
                return;
            }
            
            fishes.forEach(fish => {
                fish.time++;
                fish.wobblePhase += fish.wobbleSpeed;
                
                // Update wobble offset
                const wobbleX = Math.sin(fish.wobblePhase) * fish.wobbleAmount;
                const wobbleY = Math.cos(fish.wobblePhase * 1.5) * (fish.wobbleAmount * 0.5);
                
                // Move toward target with wobble
                const dx = fish.targetX - fish.x + wobbleX;
                const dy = fish.targetY - fish.y + wobbleY;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance > 20) {
                    // Smooth movement with some randomness
                    const angle = Math.atan2(dy, dx);
                    const randomDeviation = (Math.random() - 0.5) * 0.2;
                    const actualAngle = angle + randomDeviation;
                    
                    fish.x += Math.cos(actualAngle) * fish.speed;
                    fish.y += Math.sin(actualAngle) * fish.speed;
                    
                    // Update fish position
                    fish.element.style.left = `${fish.x}px`;
                    fish.element.style.top = `${fish.y}px`;
                    
                    // Flip direction based on movement
                    if (dx > 0 && fish.direction === -1) {
                        fish.element.style.transform = `scale(${Math.abs(parseFloat(fish.element.style.transform.match(/scale\(([^)]+)\)/)?.[1] || 0.5))})`;
                        fish.direction = 1;
                    } else if (dx < 0 && fish.direction === 1) {
                        fish.element.style.transform = `scale(${-Math.abs(parseFloat(fish.element.style.transform.match(/scale\(([^)]+)\)/)?.[1] || 0.5))})`;
                        fish.direction = -1;
                    }
                } else {
                    // Set new random target
                    fish.targetX = Math.random() * (window.innerWidth - 200) + 100;
                    fish.targetY = Math.random() * (window.innerHeight - 200) + 100;
                }
            });
            
            requestAnimationFrame(animateFish);
        }
        
        // Event listeners
        startBtn.addEventListener('click', startGame);
        startBtn.addEventListener('touchstart', function(e) {
            e.preventDefault();
            startGame();
        }, { passive: false });
        
        playAgainBtn.addEventListener('click', restartGame);
        playAgainBtn.addEventListener('touchstart', function(e) {
            e.preventDefault();
            restartGame();
        }, { passive: false });
        
        menuBtn.addEventListener('click', returnToMenu);
        menuBtn.addEventListener('touchstart', function(e) {
            e.preventDefault();
            returnToMenu();
        }, { passive: false });
        
        // Handle window resize
        window.addEventListener('resize', function() {
            // Reposition fish if they go out of bounds
            fishes.forEach(fish => {
                const rect = fish.element.getBoundingClientRect();
                if (rect.right < -100 || rect.bottom < -100 || 
                    rect.left > window.innerWidth + 100 || rect.top > window.innerHeight + 100) {
                    fish.x = Math.random() * (window.innerWidth - 200) + 100;
                    fish.y = Math.random() * (window.innerHeight - 200) + 100;
                    fish.element.style.left = `${fish.x}px`;
                    fish.element.style.top = `${fish.y}px`;
                }
            });
        });
        
        // Multi-touch support
        document.addEventListener('touchstart', function(e) {
            if (!gameRunning) return;
            
            // Prevent default to avoid scrolling
            if (e.target.closest('.fish-container')) {
                e.preventDefault();
            }
        }, { passive: false });
        
        // Initialize animation loop
        animateFish();
    </script>
</body>
</html>