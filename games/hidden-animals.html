<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Hidden Animals - Find Them All!</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
  background:#051810;overflow:hidden;color:white;
  -webkit-user-select:none;user-select:none;touch-action:none;
}
.game-wrap{position:relative;width:100vw;height:100vh;overflow:hidden}
canvas{position:absolute;inset:0}

.animal-btn{
  position:absolute;z-index:50;
  font-size:clamp(36px,5vw,56px);
  cursor:pointer;line-height:1;
  transition:transform .2s ease,filter .2s ease,opacity .3s ease;
  filter:saturate(.3) brightness(.55);
  opacity:.6;
}
.animal-btn:hover{filter:saturate(.5) brightness(.7);opacity:.75}
.animal-btn.found{
  filter:saturate(1) brightness(1) drop-shadow(0 4px 16px rgba(255,255,255,.5));
  opacity:1;cursor:default;
  animation:animalPop .5s ease;
  z-index:55;
}
@keyframes animalPop{
  0%{transform:scale(0.3);opacity:0}
  50%{transform:scale(1.3)}
  100%{transform:scale(1);opacity:1}
}

.hud{
  position:absolute;top:16px;left:16px;
  display:flex;gap:12px;z-index:100;pointer-events:none;
}
.hud-box{
  background:rgba(15,35,25,.92);backdrop-filter:blur(12px);
  border:2px solid rgba(76,175,80,.45);border-radius:14px;
  padding:12px 20px;pointer-events:auto;text-align:center;min-width:90px;
}
.hud-label{font-size:12px;color:rgba(255,255,255,.6);margin-bottom:2px}
.hud-value{font-size:28px;font-weight:700;color:#81c784}

.checklist{
  position:absolute;top:16px;right:16px;
  background:rgba(15,35,25,.94);backdrop-filter:blur(12px);
  border:2px solid rgba(76,175,80,.45);border-radius:14px;
  padding:16px;width:210px;z-index:100;
  max-height:calc(100vh - 120px);overflow-y:auto;
}
.checklist-title{font-size:16px;font-weight:700;color:#81c784;text-align:center;margin-bottom:12px}
.cl-item{
  display:flex;align-items:center;gap:10px;
  padding:7px 8px;margin-bottom:5px;
  background:rgba(255,255,255,.04);border-radius:8px;
  transition:all .35s ease;
}
.cl-item.found{background:rgba(76,175,80,.25);border:1px solid rgba(76,175,80,.4)}
.cl-emoji{font-size:22px;filter:grayscale(1) brightness(.6);transition:all .35s ease;flex-shrink:0}
.cl-item.found .cl-emoji{filter:none;animation:iconPop .5s ease}
@keyframes iconPop{0%,100%{transform:scale(1)}50%{transform:scale(1.35)}}
.cl-name{font-size:13px;color:rgba(255,255,255,.6);flex:1}
.cl-item.found .cl-name{color:white;font-weight:600}

.btn-row{
  position:absolute;bottom:24px;left:50%;transform:translateX(-50%);
  display:flex;gap:14px;z-index:100;
}
.btn{
  padding:13px 30px;font-size:16px;font-weight:600;border-radius:50px;
  cursor:pointer;transition:all .3s ease;backdrop-filter:blur(10px);border:2px solid;
}
.btn-hint{background:rgba(255,193,7,.2);border-color:rgba(255,193,7,.5);color:white}
.btn-hint:hover{background:rgba(255,193,7,.3);transform:scale(1.05)}
.btn-hint:disabled{opacity:.4;cursor:not-allowed;transform:none}
.btn-back{background:rgba(129,199,132,.15);border-color:rgba(129,199,132,.4);color:white}
.btn-back:hover{background:rgba(129,199,132,.25);transform:scale(1.05)}

.overlay{
  position:fixed;inset:0;background:rgba(0,0,0,.88);
  display:none;justify-content:center;align-items:center;z-index:2000;
}
.overlay.show{display:flex}
.overlay-box{
  text-align:center;padding:40px;
  background:rgba(20,50,35,.96);backdrop-filter:blur(20px);
  border:3px solid rgba(129,199,132,.7);border-radius:24px;
  max-width:480px;animation:boxIn .4s ease;
}
@keyframes boxIn{from{transform:scale(.7);opacity:0}to{transform:scale(1);opacity:1}}
.overlay-title{font-size:44px;color:#81c784;margin-bottom:16px}
.overlay-msg{font-size:22px;margin-bottom:24px}
.overlay-stats{font-size:16px;color:rgba(255,255,255,.75);margin-bottom:28px;line-height:1.8}
.overlay-btn{
  padding:14px 36px;font-size:18px;font-weight:600;
  background:rgba(129,199,132,.25);border:2px solid rgba(129,199,132,.7);
  color:white;border-radius:50px;cursor:pointer;transition:all .3s;margin:6px;
}
.overlay-btn:hover{background:rgba(129,199,132,.4);transform:scale(1.05)}

.ripple{
  position:absolute;
  border:3px solid rgba(129,199,132,.8);border-radius:50%;
  pointer-events:none;z-index:60;
  animation:rippleOut .7s ease-out forwards;
}
@keyframes rippleOut{0%{width:0;height:0;opacity:1}100%{width:120px;height:120px;opacity:0}}

.found-burst{
  position:absolute;pointer-events:none;z-index:70;font-size:18px;
  animation:burstOut .8s ease-out forwards;
}
@keyframes burstOut{
  0%{transform:translate(0,0) scale(1);opacity:1}
  100%{transform:translate(var(--bx),var(--by)) scale(.3);opacity:0}
}

.hint-ring{
  position:absolute;pointer-events:none;z-index:55;
  border:3px dashed rgba(255,193,7,.8);border-radius:50%;
  animation:hintPulse 3s ease-out forwards;
}
@keyframes hintPulse{
  0%{opacity:0;transform:translate(-50%,-50%) scale(.5)}
  20%{opacity:1;transform:translate(-50%,-50%) scale(1)}
  80%{opacity:.8;transform:translate(-50%,-50%) scale(1.05)}
  100%{opacity:0;transform:translate(-50%,-50%) scale(1.1)}
}

@media(max-width:768px){
  .checklist{width:170px;padding:10px}
  .cl-item{padding:5px 6px}
  .hud-value{font-size:22px}
}
</style>
</head>
<body>
<div class="game-wrap" id="gameWrap">
  <canvas id="scene"></canvas>

  <div class="hud">
    <div class="hud-box">
      <div class="hud-label">Found</div>
      <div class="hud-value" id="scoreVal">0/8</div>
    </div>
    <div class="hud-box">
      <div class="hud-label">Time</div>
      <div class="hud-value" id="timeVal">0:00</div>
    </div>
  </div>

  <div class="checklist">
    <div class="checklist-title">Find These Animals</div>
    <div id="clList"></div>
  </div>

  <div class="btn-row">
    <button class="btn btn-hint" id="hintBtn">Hint (3)</button>
    <button class="btn btn-back" onclick="location.href='../index.html'">Menu</button>
  </div>

  <div class="overlay" id="winOverlay">
    <div class="overlay-box">
      <div class="overlay-title">Well Done!</div>
      <div class="overlay-msg">All animals found!</div>
      <div class="overlay-stats" id="winStats"></div>
      <button class="overlay-btn" onclick="location.reload()">Play Again</button>
      <button class="overlay-btn" onclick="location.href='../index.html'" style="margin-left:8px">Menu</button>
    </div>
  </div>
</div>

<script>
const cvs = document.getElementById('scene');
const ctx = cvs.getContext('2d');
const wrap = document.getElementById('gameWrap');
let W, H;

const ALL_ANIMALS = [
  { emoji:'\uD83E\uDD8A', name:'Fox' },
  { emoji:'\uD83D\uDC3B', name:'Bear' },
  { emoji:'\uD83E\uDD8C', name:'Deer' },
  { emoji:'\uD83E\uDD89', name:'Owl' },
  { emoji:'\uD83E\uDD9D', name:'Raccoon' },
  { emoji:'\uD83D\uDC3F\uFE0F', name:'Squirrel' },
  { emoji:'\uD83E\uDD94', name:'Hedgehog' },
  { emoji:'\uD83D\uDC30', name:'Rabbit' },
  { emoji:'\uD83E\uDD85', name:'Eagle' },
  { emoji:'\uD83E\uDD8E', name:'Lizard' },
  { emoji:'\uD83D\uDC0D', name:'Snake' },
  { emoji:'\uD83E\uDD9C', name:'Parrot' },
  { emoji:'\uD83D\uDC38', name:'Frog' },
  { emoji:'\uD83E\uDD8B', name:'Butterfly' },
  { emoji:'\uD83D\uDC22', name:'Turtle' },
  { emoji:'\uD83E\uDDA5', name:'Sloth' },
  { emoji:'\uD83D\uDC12', name:'Monkey' },
  { emoji:'\uD83E\uDD9A', name:'Peacock' },
  { emoji:'\uD83E\uDD86', name:'Duck' },
  { emoji:'\uD83D\uDC1D', name:'Bee' }
];

const GAME_COUNT = 8;

function shuffle(a) {
  const arr = [...a];
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

const gameAnimals = shuffle(ALL_ANIMALS).slice(0, GAME_COUNT);
let hiddenAnimals = [];
let score = 0, hints = 3, elapsed = 0, timer = null;
let foliage = [], trees = [], lightRays = [], groundPlants = [];

function resize() {
  W = cvs.width = window.innerWidth;
  H = cvs.height = window.innerHeight;
  buildScene();
}
window.addEventListener('resize', resize);
resize();

function buildScene() {
  trees = [];
  for (let i = 0; i < 12; i++) {
    trees.push({
      x: (i / 12) * W + (Math.random() - .5) * W * .08,
      trunkW: 12 + Math.random() * 16,
      trunkH: H * (.3 + Math.random() * .3),
      canopyR: 40 + Math.random() * 60,
      hue: 100 + Math.random() * 50,
      layer: Math.random() < .5 ? 0 : 1
    });
  }

  foliage = [];
  for (let i = 0; i < 80; i++) {
    foliage.push({
      x: Math.random() * W,
      y: Math.random() * H,
      r: 20 + Math.random() * 55,
      hue: 90 + Math.random() * 70,
      sat: 30 + Math.random() * 30,
      light: 12 + Math.random() * 18,
      alpha: .08 + Math.random() * .2,
      speed: .2 + Math.random() * .6,
      phase: Math.random() * Math.PI * 2
    });
  }

  groundPlants = [];
  for (let i = 0; i < 50; i++) {
    groundPlants.push({
      x: Math.random() * W,
      h: 20 + Math.random() * 80,
      lean: (Math.random() - .5) * 20,
      hue: 95 + Math.random() * 55,
      alpha: .15 + Math.random() * .25,
      phase: Math.random() * Math.PI * 2
    });
  }

  lightRays = [];
  for (let i = 0; i < 6; i++) {
    lightRays.push({
      x: W * (.1 + Math.random() * .8),
      w: 30 + Math.random() * 60,
      alpha: .02 + Math.random() * .04,
      speed: .15 + Math.random() * .3,
      phase: Math.random() * Math.PI * 2
    });
  }
}

function placeAnimals() {
  hiddenAnimals = [];
  const margin = 100;
  const minDist = 110;

  gameAnimals.forEach(def => {
    let x, y, tries = 0;
    do {
      x = margin + Math.random() * (W - margin * 2);
      y = margin + Math.random() * (H - margin * 2);
      tries++;
    } while (tries < 300 && hiddenAnimals.some(a => Math.hypot(a.x - x, a.y - y) < minDist));

    hiddenAnimals.push({
      ...def,
      x, y,
      found: false
    });
  });

  hiddenAnimals.forEach(a => {
    const el = document.createElement('div');
    el.className = 'animal-btn';
    el.textContent = a.emoji;
    el.style.left = (a.x - 28) + 'px';
    el.style.top = (a.y - 28) + 'px';
    a.el = el;
    wrap.appendChild(el);
  });
}

function buildChecklist() {
  const el = document.getElementById('clList');
  el.innerHTML = '';
  gameAnimals.forEach((a, i) => {
    const item = document.createElement('div');
    item.className = 'cl-item';
    item.id = 'cl-' + i;
    item.innerHTML = '<span class="cl-emoji">' + a.emoji + '</span><span class="cl-name">' + a.name + '</span>';
    el.appendChild(item);
  });
}

function startTimer() {
  timer = setInterval(() => {
    elapsed++;
    const m = Math.floor(elapsed / 60);
    const s = elapsed % 60;
    document.getElementById('timeVal').textContent = m + ':' + (s < 10 ? '0' : '') + s;
  }, 1000);
}

function drawScene(now) {
  const t = now * .001;

  const skyGrad = ctx.createLinearGradient(0, 0, 0, H);
  skyGrad.addColorStop(0, '#0a2818');
  skyGrad.addColorStop(.3, '#0d3520');
  skyGrad.addColorStop(.7, '#072a15');
  skyGrad.addColorStop(1, '#041a0d');
  ctx.fillStyle = skyGrad;
  ctx.fillRect(0, 0, W, H);

  const moonX = W * .15, moonY = H * .12;
  const moonGrad = ctx.createRadialGradient(moonX, moonY, 0, moonX, moonY, 180);
  moonGrad.addColorStop(0, 'rgba(200,230,200,.08)');
  moonGrad.addColorStop(1, 'rgba(200,230,200,0)');
  ctx.fillStyle = moonGrad;
  ctx.fillRect(0, 0, W, H * .5);

  lightRays.forEach(r => {
    const sway = Math.sin(t * r.speed + r.phase) * 15;
    const a = r.alpha * (.6 + Math.sin(t * .5 + r.phase) * .4);
    ctx.save();
    ctx.globalAlpha = a;
    ctx.fillStyle = 'rgba(180,220,150,.3)';
    ctx.beginPath();
    ctx.moveTo(r.x + sway - r.w / 2, 0);
    ctx.lineTo(r.x + sway + r.w / 2, 0);
    ctx.lineTo(r.x + sway + r.w * 1.5, H);
    ctx.lineTo(r.x + sway - r.w * 1.5, H);
    ctx.closePath();
    ctx.fill();
    ctx.restore();
  });

  trees.filter(tr => tr.layer === 0).forEach(tr => drawTree(tr, t));

  foliage.forEach(f => {
    const ox = Math.sin(t * f.speed + f.phase) * 8;
    const oy = Math.cos(t * f.speed * .7 + f.phase) * 5;
    ctx.beginPath();
    ctx.arc(f.x + ox, f.y + oy, f.r, 0, Math.PI * 2);
    ctx.fillStyle = 'hsla(' + f.hue + ',' + f.sat + '%,' + f.light + '%,' + f.alpha + ')';
    ctx.fill();
  });

  trees.filter(tr => tr.layer === 1).forEach(tr => drawTree(tr, t));

  groundPlants.forEach(gp => {
    const sway = Math.sin(t * .8 + gp.phase) * 6;
    ctx.save();
    ctx.strokeStyle = 'hsla(' + gp.hue + ',40%,22%,' + gp.alpha + ')';
    ctx.lineWidth = 2.5;
    ctx.beginPath();
    ctx.moveTo(gp.x, H);
    ctx.quadraticCurveTo(gp.x + gp.lean + sway, H - gp.h * .6, gp.x + sway * 1.5, H - gp.h);
    ctx.stroke();

    if (gp.h > 50) {
      ctx.beginPath();
      ctx.ellipse(gp.x + sway * 1.5, H - gp.h, gp.h * .18, gp.h * .12, 0, 0, Math.PI * 2);
      ctx.fillStyle = 'hsla(' + gp.hue + ',40%,20%,' + (gp.alpha * .6) + ')';
      ctx.fill();
    }
    ctx.restore();
  });

  ctx.fillStyle = 'rgba(5,24,16,.3)';
  ctx.fillRect(0, H - 40, W, 40);
}

function drawTree(tr, t) {
  const sway = Math.sin(t * .3 + tr.x * .01) * 4;
  const baseY = H - 20;

  ctx.fillStyle = '#2a1a0e';
  ctx.fillRect(tr.x - tr.trunkW / 2, baseY - tr.trunkH, tr.trunkW, tr.trunkH + 20);
  ctx.fillStyle = '#3a2415';
  ctx.fillRect(tr.x - tr.trunkW / 2 + 2, baseY - tr.trunkH, tr.trunkW * .3, tr.trunkH);

  const cy = baseY - tr.trunkH - tr.canopyR * .3;
  for (let l = 0; l < 3; l++) {
    const r = tr.canopyR * (1 - l * .2);
    const ox = sway * (1 + l * .3);
    const oy = -l * tr.canopyR * .3;
    ctx.beginPath();
    ctx.arc(tr.x + ox, cy + oy, r, 0, Math.PI * 2);
    ctx.fillStyle = 'hsla(' + tr.hue + ',45%,' + (14 + l * 4) + '%,.7)';
    ctx.fill();
  }
}

function loop(now) {
  drawScene(now);
  requestAnimationFrame(loop);
}

function hitTest(px, py) {
  for (let i = 0; i < hiddenAnimals.length; i++) {
    const a = hiddenAnimals[i];
    if (a.found) continue;
    if (Math.hypot(px - a.x, py - a.y) < 45) return i;
  }
  return -1;
}

function revealAnimal(idx) {
  const a = hiddenAnimals[idx];
  if (a.found) return;
  a.found = true;
  a.el.classList.add('found');
  score++;
  document.getElementById('scoreVal').textContent = score + '/' + GAME_COUNT;

  const clIdx = gameAnimals.findIndex(g => g.name === a.name);
  if (clIdx >= 0) document.getElementById('cl-' + clIdx).classList.add('found');

  spawnBurst(a.x, a.y);
  playChime();
  if (score === GAME_COUNT) endGame();
}

function spawnRipple(x, y) {
  const r = document.createElement('div');
  r.className = 'ripple';
  r.style.left = x + 'px';
  r.style.top = y + 'px';
  r.style.marginLeft = '-60px';
  r.style.marginTop = '-60px';
  wrap.appendChild(r);
  r.addEventListener('animationend', () => r.remove());
}

function spawnBurst(x, y) {
  const bits = ['\u2B50', '\u2728', '\uD83C\uDF1F', '\uD83D\uDCAB', '\u2764\uFE0F'];
  for (let i = 0; i < 12; i++) {
    const el = document.createElement('div');
    el.className = 'found-burst';
    el.textContent = bits[i % bits.length];
    el.style.left = x + 'px';
    el.style.top = y + 'px';
    const angle = (i / 12) * Math.PI * 2;
    const dist = 60 + Math.random() * 70;
    el.style.setProperty('--bx', (Math.cos(angle) * dist) + 'px');
    el.style.setProperty('--by', (Math.sin(angle) * dist) + 'px');
    wrap.appendChild(el);
    el.addEventListener('animationend', () => el.remove());
  }
}

function playChime() {
  try {
    const ac = new (window.AudioContext || window.webkitAudioContext)();
    [523.25, 659.25, 783.99].forEach((freq, i) => {
      const o = ac.createOscillator(), g = ac.createGain();
      o.connect(g); g.connect(ac.destination);
      o.frequency.value = freq; o.type = 'sine';
      const t0 = ac.currentTime + i * .08;
      g.gain.setValueAtTime(.2, t0);
      g.gain.exponentialRampToValueAtTime(.001, t0 + .3);
      o.start(t0); o.stop(t0 + .3);
    });
  } catch (_) {}
}

function endGame() {
  clearInterval(timer);
  setTimeout(() => {
    const m = Math.floor(elapsed / 60);
    const s = elapsed % 60;
    document.getElementById('winStats').innerHTML =
      'Time: ' + m + ':' + (s < 10 ? '0' : '') + s + '<br>Hints used: ' + (3 - hints);
    document.getElementById('winOverlay').classList.add('show');
  }, 600);
}

function useHint() {
  if (hints <= 0) return;
  const remaining = hiddenAnimals.filter(a => !a.found);
  if (!remaining.length) return;
  const target = remaining[Math.floor(Math.random() * remaining.length)];

  const ring = document.createElement('div');
  ring.className = 'hint-ring';
  ring.style.left = target.x + 'px';
  ring.style.top = target.y + 'px';
  ring.style.width = '90px';
  ring.style.height = '90px';
  wrap.appendChild(ring);
  ring.addEventListener('animationend', () => ring.remove());

  hints--;
  const btn = document.getElementById('hintBtn');
  btn.textContent = hints > 0 ? 'Hint (' + hints + ')' : 'No Hints';
  if (hints <= 0) btn.disabled = true;
}

document.getElementById('hintBtn').addEventListener('click', useHint);

function handleTap(x, y) {
  spawnRipple(x, y);
  const idx = hitTest(x, y);
  if (idx >= 0) revealAnimal(idx);
}

cvs.addEventListener('touchstart', e => {
  e.preventDefault();
  for (let i = 0; i < e.changedTouches.length; i++) {
    const t = e.changedTouches[i];
    handleTap(t.clientX, t.clientY);
  }
}, { passive: false });

cvs.addEventListener('click', e => handleTap(e.clientX, e.clientY));

wrap.addEventListener('click', e => {
  if (!e.target.classList.contains('animal-btn')) return;
  const rect = e.target.getBoundingClientRect();
  const cx = rect.left + rect.width / 2;
  const cy = rect.top + rect.height / 2;
  const idx = hitTest(cx, cy);
  if (idx >= 0) {
    spawnRipple(cx, cy);
    revealAnimal(idx);
  }
});

wrap.addEventListener('touchstart', e => {
  if (!e.target.classList.contains('animal-btn')) return;
  e.preventDefault();
  const rect = e.target.getBoundingClientRect();
  const cx = rect.left + rect.width / 2;
  const cy = rect.top + rect.height / 2;
  const idx = hitTest(cx, cy);
  if (idx >= 0) {
    spawnRipple(cx, cy);
    revealAnimal(idx);
  }
}, { passive: false });

document.getElementById('scoreVal').textContent = '0/' + GAME_COUNT;
placeAnimals();
buildChecklist();
startTimer();
requestAnimationFrame(loop);
</script>
</body>
</html>
