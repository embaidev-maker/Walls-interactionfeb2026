<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Forest Animals Showcase</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;touch-action:manipulation;-webkit-tap-highlight-color:transparent}
html,body{width:100%;height:100%;overflow:hidden}
body{
  font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
  background:#071a10;color:white;
  -webkit-user-select:none;user-select:none;
}

.scene{position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden}
.firefly{
  position:absolute;width:4px;height:4px;border-radius:50%;
  background:#ffd54f;box-shadow:0 0 8px 3px rgba(255,213,79,.5);
  animation:fly var(--dur) ease-in-out infinite;
}
@keyframes fly{
  0%{opacity:0;transform:translate(0,0)}
  25%{opacity:1}50%{opacity:.3;transform:translate(var(--dx),var(--dy))}
  75%{opacity:1}100%{opacity:0;transform:translate(0,0)}
}
.leaf{
  position:absolute;font-size:16px;opacity:0;
  animation:leafDrop var(--dur) linear infinite;
}
@keyframes leafDrop{
  0%{transform:translate(0,-20px) rotate(0);opacity:0}
  10%{opacity:.6}90%{opacity:.4}
  100%{transform:translate(var(--dx),100vh) rotate(720deg);opacity:0}
}

.app{position:relative;z-index:1;width:100%;height:100%;display:flex;flex-direction:column}

.header{flex-shrink:0;text-align:center;padding:12px 20px 6px}
.header h1{font-size:clamp(18px,2.8vw,28px);font-weight:800;color:#a5d6a7;text-shadow:0 3px 12px rgba(0,0,0,.6)}
.header p{font-size:clamp(10px,1.3vw,13px);color:rgba(255,255,255,.45)}

.scroll-area{
  flex:1;min-height:0;position:relative;
  display:flex;align-items:stretch;
  padding:8px 0;
}
.scroll-track{
  display:flex;gap:16px;
  overflow-x:auto;overflow-y:hidden;
  padding:0 48px;
  scroll-snap-type:x mandatory;
  scroll-behavior:smooth;
  -webkit-overflow-scrolling:touch;
  scrollbar-width:none;
}
.scroll-track::-webkit-scrollbar{display:none}

.arrow-btn{
  position:absolute;top:50%;transform:translateY(-50%);
  width:clamp(36px,3.5vw,44px);height:clamp(36px,3.5vw,44px);
  border-radius:50%;
  background:rgba(0,0,0,.6);backdrop-filter:blur(8px);
  border:2px solid rgba(129,199,132,.35);
  color:white;font-size:clamp(14px,1.6vw,18px);
  cursor:pointer;z-index:10;
  display:flex;align-items:center;justify-content:center;
  transition:all .3s;
}
.arrow-btn:hover{background:rgba(129,199,132,.2);border-color:rgba(129,199,132,.6)}
.arrow-btn:active{transform:translateY(-50%) scale(.92)}
.arrow-left{left:6px}
.arrow-right{right:6px}

.card{
  flex-shrink:0;
  width:clamp(280px,28vw,380px);
  scroll-snap-align:center;
  background:rgba(255,255,255,.04);
  border:1px solid rgba(129,199,132,.2);
  border-radius:16px;
  display:flex;flex-direction:column;
  overflow:hidden;
  transition:border-color .3s,box-shadow .3s;
}
.card:hover{
  border-color:rgba(129,199,132,.45);
  box-shadow:0 6px 30px rgba(0,0,0,.4),0 0 20px rgba(129,199,132,.08);
}

.model-area{
  flex-shrink:0;
  height:clamp(140px,18vh,200px);
  background:rgba(0,0,0,.3);
  display:flex;align-items:center;justify-content:center;
  position:relative;overflow:hidden;
  border-bottom:1px solid rgba(129,199,132,.12);
}
.model-placeholder{
  perspective:300px;
  width:90px;height:90px;
  position:relative;
}
.cube{
  width:100%;height:100%;position:relative;
  transform-style:preserve-3d;
  animation:spin 8s linear infinite;
}
@keyframes spin{
  0%{transform:rotateX(-20deg) rotateY(0)}
  100%{transform:rotateX(-20deg) rotateY(360deg)}
}
.cube-face{
  position:absolute;width:90px;height:90px;
  display:flex;align-items:center;justify-content:center;
  font-size:48px;
  border:2px solid rgba(129,199,132,.3);
  background:rgba(15,40,25,.8);
  backface-visibility:visible;
}
.cube-face:nth-child(1){transform:rotateY(0deg) translateZ(45px)}
.cube-face:nth-child(2){transform:rotateY(90deg) translateZ(45px)}
.cube-face:nth-child(3){transform:rotateY(180deg) translateZ(45px)}
.cube-face:nth-child(4){transform:rotateY(-90deg) translateZ(45px)}
.cube-face:nth-child(5){transform:rotateX(90deg) translateZ(45px)}
.cube-face:nth-child(6){transform:rotateX(-90deg) translateZ(45px)}
.model-badge{
  position:absolute;bottom:6px;right:8px;
  font-size:9px;color:rgba(255,255,255,.3);
  background:rgba(0,0,0,.4);padding:2px 8px;border-radius:8px;
  letter-spacing:.5px;
}

.card-body{
  flex:1;padding:12px 16px;display:flex;flex-direction:column;gap:6px;
  overflow-y:auto;min-height:0;
}
.card-body::-webkit-scrollbar{width:3px}
.card-body::-webkit-scrollbar-thumb{background:rgba(129,199,132,.25);border-radius:3px}

.card-top{display:flex;align-items:center;gap:10px;margin-bottom:2px}
.card-emoji{font-size:clamp(28px,3vw,38px);filter:drop-shadow(0 3px 8px rgba(0,0,0,.5))}
.card-titles{display:flex;flex-direction:column}
.card-name{font-size:clamp(15px,1.6vw,20px);font-weight:700;color:#a5d6a7;line-height:1.2}
.card-latin{font-size:clamp(9px,.9vw,11px);font-style:italic;color:rgba(255,255,255,.3)}

.card-desc{font-size:clamp(11px,1.1vw,13px);color:rgba(255,255,255,.65);line-height:1.5}

.facts-list{list-style:none;padding:0;display:flex;flex-direction:column;gap:3px}
.facts-list li{
  font-size:clamp(10px,1vw,12px);color:rgba(255,255,255,.7);
  line-height:1.45;padding:3px 0 3px 18px;position:relative;
}
.facts-list li::before{
  content:'';position:absolute;left:2px;top:50%;transform:translateY(-50%);
  width:7px;height:7px;border-radius:50%;
  background:rgba(129,199,132,.5);border:1px solid rgba(129,199,132,.7);
}
.facts-list li:nth-child(2)::before{background:rgba(255,193,7,.5);border-color:rgba(255,193,7,.7)}
.facts-list li:nth-child(3)::before{background:rgba(79,195,247,.5);border-color:rgba(79,195,247,.7)}
.facts-list li:nth-child(4)::before{background:rgba(239,154,154,.5);border-color:rgba(239,154,154,.7)}
.facts-list li:nth-child(5)::before{background:rgba(206,147,216,.5);border-color:rgba(206,147,216,.7)}

.card-sound{
  display:inline-flex;align-items:center;gap:5px;
  padding:5px 12px;margin-top:auto;align-self:flex-start;
  background:rgba(129,199,132,.1);border:1px solid rgba(129,199,132,.3);
  border-radius:16px;color:#a5d6a7;
  font-size:clamp(9px,1vw,12px);font-weight:600;
  cursor:pointer;transition:all .3s;flex-shrink:0;
}
.card-sound:hover,.card-sound:active{background:rgba(129,199,132,.22)}
.card-sound.playing{background:rgba(129,199,132,.3);border-color:rgba(129,199,132,.6)}

.footer{
  flex-shrink:0;text-align:center;
  padding:6px 20px 12px;
}
.btn-back{
  padding:8px 26px;font-size:14px;font-weight:600;
  background:rgba(129,199,132,.1);border:2px solid rgba(129,199,132,.3);
  color:white;border-radius:50px;cursor:pointer;
  transition:all .3s;backdrop-filter:blur(8px);
}
.btn-back:hover,.btn-back:active{background:rgba(129,199,132,.2);border-color:rgba(129,199,132,.5)}

.touch-ring{
  position:fixed;width:60px;height:60px;
  border:3px solid rgba(129,199,132,.6);border-radius:50%;
  pointer-events:none;z-index:9999;
  transform:translate(-50%,-50%) scale(0);
  animation:ringPop .6s ease forwards;
}
@keyframes ringPop{
  0%{transform:translate(-50%,-50%) scale(0);opacity:1}
  100%{transform:translate(-50%,-50%) scale(2);opacity:0}
}
</style>
</head>
<body>
<div class="scene" id="scene"></div>

<div class="app">
  <div class="header">
    <h1>Forest Animals Showcase</h1>
    <p>Scroll through the animals to learn fun facts and hear their sounds</p>
  </div>

  <div class="scroll-area">
    <button class="arrow-btn arrow-left" id="prevBtn">&#9664;</button>
    <div class="scroll-track" id="scrollTrack"></div>
    <button class="arrow-btn arrow-right" id="nextBtn">&#9654;</button>
  </div>

  <div class="footer">
    <button class="btn-back" id="backBtn">Back to Menu</button>
  </div>
</div>

<script>
var ANIMALS = [
  {
    name:'Red Deer', latin:'Cervus elaphus', emoji:'\uD83E\uDD8C',
    desc:'Majestic woodland herbivores found across European and Asian forests. Males grow impressive antlers each year.',
    facts:[
      'Antlers grow up to 1 inch per day -- fastest bone growth in nature!',
      'Males roar up to 20 times per minute during mating season',
      'Can run at 40 mph -- faster than a city bus!',
      'Shed and regrow their antlers every single year',
      'Babies (fawns) are born with white spots for camouflage'
    ],
    sound:{type:'bellow',freq:130,dur:0.9}
  },
  {
    name:'Red Fox', latin:'Vulpes vulpes', emoji:'\uD83E\uDD8A',
    desc:'Clever and adaptable predators with exceptional hearing. The most widespread wild carnivore on Earth.',
    facts:[
      'Can hear a watch ticking from 40 yards away!',
      'Use Earth\'s magnetic field like a compass to hunt',
      'Have over 40 different calls and vocalizations',
      'Their pupils are vertical slits -- just like a cat!',
      'Pounce on prey using a special "mousing leap"'
    ],
    sound:{type:'bark',freq:800,dur:0.12}
  },
  {
    name:'Brown Bear', latin:'Ursus arctos', emoji:'\uD83D\uDC3B',
    desc:'Powerful omnivores that roam vast territories. Among the largest land predators still walking the Earth.',
    facts:[
      'Can eat 90 pounds of food per day before winter sleep!',
      'Sprint at 35 mph -- faster than most horses',
      'Nose is 7 times better than a bloodhound\'s',
      'Hibernate for 5 to 7 months without eating or drinking',
      'Cubs are born blind and weigh less than a pound'
    ],
    sound:{type:'growl',freq:75,dur:1.2}
  },
  {
    name:'Great Horned Owl', latin:'Bubo virginianus', emoji:'\uD83E\uDD89',
    desc:'Silent nocturnal hunters with extraordinary night vision. Their feathers muffle sound for stealthy flight.',
    facts:[
      'Can turn their head 270 degrees -- almost all the way around!',
      'Fly in complete silence thanks to special feather edges',
      'Eyes are fixed in place -- they can\'t move them at all',
      'Grip strength is 300 PSI -- 10x stronger than a human hand',
      'Hunt in pitch darkness using only sound to locate prey'
    ],
    sound:{type:'hoot',freq:300,dur:0.4}
  },
  {
    name:'Raccoon', latin:'Procyon lotor', emoji:'\uD83E\uDD9D',
    desc:'Curious and intelligent creatures famous for their masked faces and dexterous front paws.',
    facts:[
      'Can remember how to solve puzzles for 3 whole years!',
      'Front paws are incredibly sensitive -- like tiny human hands',
      'Wash their food in water before eating it',
      'Can rotate their hind feet 180 degrees to climb DOWN trees',
      'Active mostly at night with amazing night vision'
    ],
    sound:{type:'chitter',freq:600,dur:0.06}
  },
  {
    name:'Red Squirrel', latin:'Sciurus vulgaris', emoji:'\uD83D\uDC3F\uFE0F',
    desc:'Acrobatic woodland gymnasts that spend their lives leaping between treetops at amazing speeds.',
    facts:[
      'Bury up to 10,000 nuts each autumn as food stores!',
      'Can leap 10 times their own body length in one jump',
      'Front teeth never stop growing -- they gnaw to keep them short',
      'Plant thousands of trees by forgetting where they buried nuts',
      'Tail is used as a blanket, umbrella, and balance beam'
    ],
    sound:{type:'chirp',freq:900,dur:0.15}
  },
  {
    name:'Beaver', latin:'Castor fiber', emoji:'\uD83E\uDDAB',
    desc:'Nature\'s engineers that reshape entire landscapes by building dams and lodges from wood and mud.',
    facts:[
      'Build dams that can stretch over 800 meters long!',
      'Hold their breath underwater for up to 15 minutes',
      'Teeth are orange because they contain iron -- super strong!',
      'Slap their flat tail on water to warn others of danger',
      'Second-largest rodent in the world after the capybara'
    ],
    sound:{type:'slap',freq:200,dur:0.15}
  },
  {
    name:'Grey Wolf', latin:'Canis lupus', emoji:'\uD83D\uDC3A',
    desc:'Highly social pack hunters with complex communication. Each howl is unique, like a vocal fingerprint.',
    facts:[
      'Howls can be heard from 16 kilometers away!',
      'Each wolf has a unique howl -- like a voice fingerprint',
      'Hunt in organized packs with complex strategies',
      'Can travel 50 miles in a single day while hunting',
      'Pups are cared for by the entire pack, not just parents'
    ],
    sound:{type:'howl',freq:220,dur:2.0}
  },
  {
    name:'Golden Eagle', latin:'Aquila chrysaetos', emoji:'\uD83E\uDD85',
    desc:'Apex aerial predators with incredible eyesight. They dive at speeds rivaling sports cars.',
    facts:[
      'Dive at speeds up to 240 km/h -- faster than a sports car!',
      'Can spot a rabbit from over 3 kilometers away',
      'Eyesight is 8 times sharper than a human\'s',
      'Wingspan reaches up to 2.3 meters (7.5 feet) wide',
      'Mate for life and use the same nest for decades'
    ],
    sound:{type:'screech',freq:1800,dur:0.6}
  },
  {
    name:'Hedgehog', latin:'Erinaceus europaeus', emoji:'\uD83E\uDD94',
    desc:'Tiny nocturnal insectivores covered in protective spines. They curl into a tight ball when threatened.',
    facts:[
      'Covered in about 7,000 spines that are replaced each year!',
      'Curl into a tight spiky ball when scared -- nearly impossible to open',
      'Immune to some snake venoms that would harm other animals',
      'Snore loudly when they sleep -- just like humans!',
      'Can run over 6 feet per second despite tiny legs'
    ],
    sound:{type:'snuffle',freq:400,dur:0.5}
  },
  {
    name:'Forest Gecko', latin:'Phelsuma grandis', emoji:'\uD83E\uDD8E',
    desc:'Masters of camouflage and climbing. Their toe pads use van der Waals forces to grip any surface.',
    facts:[
      'Can regrow their tail if a predator grabs it!',
      'Toe pads have millions of tiny hairs that stick to any surface',
      'No eyelids -- they lick their eyeballs to keep them clean',
      'Some species can change color to match their surroundings',
      'Can climb straight up glass walls and even walk on ceilings'
    ],
    sound:{type:'click',freq:1500,dur:0.04}
  },
  {
    name:'European Hare', latin:'Lepus europaeus', emoji:'\uD83D\uDC07',
    desc:'Lightning-fast runners born ready to sprint from day one. Among the fastest land animals in Europe.',
    facts:[
      'Sprint at 70 km/h -- one of the fastest land animals!',
      'Can jump 3 meters high from a standing position',
      'Have nearly 360-degree vision to spot predators everywhere',
      'Born fully furred with eyes open -- ready to run from day one!',
      'Zigzag when running to confuse predators chasing them'
    ],
    sound:{type:'thump',freq:55,dur:0.12}
  }
];

var track = document.getElementById('scrollTrack');

function buildCards() {
  ANIMALS.forEach(function(animal, idx) {
    var card = document.createElement('div');
    card.className = 'card';

    var factsHtml = '';
    animal.facts.forEach(function(f) { factsHtml += '<li>' + f + '</li>'; });

    card.innerHTML =
      '<div class="model-area">' +
        '<div class="model-placeholder">' +
          '<div class="cube">' +
            '<div class="cube-face">' + animal.emoji + '</div>' +
            '<div class="cube-face">' + animal.emoji + '</div>' +
            '<div class="cube-face">' + animal.emoji + '</div>' +
            '<div class="cube-face">' + animal.emoji + '</div>' +
            '<div class="cube-face">' + animal.emoji + '</div>' +
            '<div class="cube-face">' + animal.emoji + '</div>' +
          '</div>' +
        '</div>' +
        '<span class="model-badge">3D MODEL PLACEHOLDER</span>' +
      '</div>' +
      '<div class="card-body">' +
        '<div class="card-top">' +
          '<span class="card-emoji">' + animal.emoji + '</span>' +
          '<div class="card-titles">' +
            '<div class="card-name">' + animal.name + '</div>' +
            '<div class="card-latin">' + animal.latin + '</div>' +
          '</div>' +
        '</div>' +
        '<div class="card-desc">' + animal.desc + '</div>' +
        '<ul class="facts-list">' + factsHtml + '</ul>' +
        '<button class="card-sound" data-index="' + idx + '">&#128266; Play Sound</button>' +
      '</div>';

    var cubeEl = card.querySelector('.cube');
    cubeEl.style.animationDelay = (-idx * 0.8) + 's';

    track.appendChild(card);
  });
}

function scrollBy(dir) {
  var cardW = track.querySelector('.card').offsetWidth + 16;
  track.scrollBy({ left: dir * cardW, behavior: 'smooth' });
}

function bindTouch(el, fn) {
  el.addEventListener('click', function(e) {
    if (e.sourceCapabilities && e.sourceCapabilities.firesTouchEvents) return;
    fn(e);
  });
  el.addEventListener('touchend', function(e) {
    e.preventDefault();
    e.stopPropagation();
    fn(e);
  });
}

bindTouch(document.getElementById('prevBtn'), function() { scrollBy(-1); });
bindTouch(document.getElementById('nextBtn'), function() { scrollBy(1); });
bindTouch(document.getElementById('backBtn'), function() { location.href = '../index.html'; });

document.addEventListener('click', function(e) {
  if (e.sourceCapabilities && e.sourceCapabilities.firesTouchEvents) return;
  var btn = e.target.closest('.card-sound');
  if (btn) playAnimalSound(ANIMALS[parseInt(btn.dataset.index)].sound, btn);
});
document.addEventListener('touchend', function(e) {
  var btn = e.target.closest('.card-sound');
  if (btn) { e.preventDefault(); playAnimalSound(ANIMALS[parseInt(btn.dataset.index)].sound, btn); }
});

function playAnimalSound(cfg, btn) {
  if (btn.classList.contains('playing')) return;
  btn.classList.add('playing');
  try {
    var ac = new (window.AudioContext || window.webkitAudioContext)();
    var now = ac.currentTime;

    if (cfg.type === 'bellow') {
      var o = ac.createOscillator(), g = ac.createGain();
      o.connect(g); g.connect(ac.destination);
      o.type = 'triangle'; o.frequency.setValueAtTime(cfg.freq, now);
      o.frequency.linearRampToValueAtTime(cfg.freq * 0.8, now + cfg.dur);
      var lfo = ac.createOscillator(), lfoG = ac.createGain();
      lfo.connect(lfoG); lfoG.connect(o.frequency);
      lfo.frequency.value = 5; lfoG.gain.value = 15; lfo.start(now);
      g.gain.setValueAtTime(0, now);
      g.gain.linearRampToValueAtTime(0.2, now + 0.1);
      g.gain.linearRampToValueAtTime(0.15, now + cfg.dur * 0.7);
      g.gain.exponentialRampToValueAtTime(0.001, now + cfg.dur);
      o.start(now); o.stop(now + cfg.dur); lfo.stop(now + cfg.dur);
    }
    else if (cfg.type === 'bark') {
      for (var b = 0; b < 3; b++) {
        var o = ac.createOscillator(), g = ac.createGain();
        o.connect(g); g.connect(ac.destination); o.type = 'square';
        var t = now + b * 0.18;
        o.frequency.setValueAtTime(cfg.freq, t);
        o.frequency.exponentialRampToValueAtTime(cfg.freq * 0.5, t + cfg.dur);
        g.gain.setValueAtTime(0.15, t);
        g.gain.exponentialRampToValueAtTime(0.001, t + cfg.dur);
        o.start(t); o.stop(t + cfg.dur);
      }
    }
    else if (cfg.type === 'growl') {
      var o = ac.createOscillator(), g = ac.createGain();
      o.connect(g); g.connect(ac.destination);
      o.type = 'sawtooth'; o.frequency.value = cfg.freq;
      var lfo = ac.createOscillator(), lfoG = ac.createGain();
      lfo.connect(lfoG); lfoG.connect(o.frequency);
      lfo.frequency.value = 3; lfoG.gain.value = 10; lfo.start(now);
      g.gain.setValueAtTime(0, now);
      g.gain.linearRampToValueAtTime(0.12, now + 0.2);
      g.gain.setValueAtTime(0.12, now + cfg.dur * 0.6);
      g.gain.exponentialRampToValueAtTime(0.001, now + cfg.dur);
      o.start(now); o.stop(now + cfg.dur); lfo.stop(now + cfg.dur);
    }
    else if (cfg.type === 'hoot') {
      [cfg.freq, cfg.freq * 0.82].forEach(function(f, i) {
        var o = ac.createOscillator(), g = ac.createGain();
        o.connect(g); g.connect(ac.destination);
        o.type = 'sine'; o.frequency.value = f;
        var t = now + i * (cfg.dur + 0.15);
        g.gain.setValueAtTime(0, t);
        g.gain.linearRampToValueAtTime(0.18, t + 0.05);
        g.gain.setValueAtTime(0.18, t + cfg.dur * 0.7);
        g.gain.exponentialRampToValueAtTime(0.001, t + cfg.dur);
        o.start(t); o.stop(t + cfg.dur);
      });
    }
    else if (cfg.type === 'chitter') {
      for (var c = 0; c < 12; c++) {
        var o = ac.createOscillator(), g = ac.createGain();
        o.connect(g); g.connect(ac.destination); o.type = 'square';
        var t = now + c * cfg.dur;
        o.frequency.value = cfg.freq + Math.random() * 200;
        g.gain.setValueAtTime(0.1, t);
        g.gain.exponentialRampToValueAtTime(0.001, t + cfg.dur * 0.8);
        o.start(t); o.stop(t + cfg.dur);
      }
    }
    else if (cfg.type === 'chirp') {
      for (var ch = 0; ch < 4; ch++) {
        var o = ac.createOscillator(), g = ac.createGain();
        o.connect(g); g.connect(ac.destination); o.type = 'sine';
        var t = now + ch * 0.2;
        o.frequency.setValueAtTime(cfg.freq, t);
        o.frequency.exponentialRampToValueAtTime(cfg.freq * 1.8, t + cfg.dur);
        g.gain.setValueAtTime(0.15, t);
        g.gain.exponentialRampToValueAtTime(0.001, t + cfg.dur);
        o.start(t); o.stop(t + cfg.dur);
      }
    }
    else if (cfg.type === 'slap') {
      var buf = ac.createBuffer(1, ac.sampleRate * cfg.dur, ac.sampleRate);
      var data = buf.getChannelData(0);
      for (var s = 0; s < data.length; s++) data[s] = (Math.random() * 2 - 1) * Math.exp(-s / (ac.sampleRate * 0.02));
      var src = ac.createBufferSource(), g = ac.createGain();
      src.buffer = buf; src.connect(g); g.connect(ac.destination);
      g.gain.setValueAtTime(0.3, now); g.gain.exponentialRampToValueAtTime(0.001, now + cfg.dur);
      src.start(now);
    }
    else if (cfg.type === 'howl') {
      var o = ac.createOscillator(), g = ac.createGain();
      o.connect(g); g.connect(ac.destination); o.type = 'sine';
      o.frequency.setValueAtTime(cfg.freq, now);
      o.frequency.linearRampToValueAtTime(cfg.freq * 2.5, now + cfg.dur * 0.4);
      o.frequency.linearRampToValueAtTime(cfg.freq * 2.2, now + cfg.dur * 0.7);
      o.frequency.linearRampToValueAtTime(cfg.freq * 1.5, now + cfg.dur);
      var lfo = ac.createOscillator(), lfoG = ac.createGain();
      lfo.connect(lfoG); lfoG.connect(o.frequency);
      lfo.frequency.value = 4; lfoG.gain.value = 8; lfo.start(now);
      g.gain.setValueAtTime(0, now);
      g.gain.linearRampToValueAtTime(0.18, now + 0.15);
      g.gain.setValueAtTime(0.18, now + cfg.dur * 0.6);
      g.gain.exponentialRampToValueAtTime(0.001, now + cfg.dur);
      o.start(now); o.stop(now + cfg.dur); lfo.stop(now + cfg.dur);
    }
    else if (cfg.type === 'screech') {
      var o = ac.createOscillator(), g = ac.createGain();
      o.connect(g); g.connect(ac.destination); o.type = 'sawtooth';
      o.frequency.setValueAtTime(cfg.freq, now);
      o.frequency.exponentialRampToValueAtTime(cfg.freq * 0.4, now + cfg.dur);
      g.gain.setValueAtTime(0.1, now); g.gain.exponentialRampToValueAtTime(0.001, now + cfg.dur);
      o.start(now); o.stop(now + cfg.dur);
    }
    else if (cfg.type === 'snuffle') {
      for (var sn = 0; sn < 5; sn++) {
        var buf = ac.createBuffer(1, ac.sampleRate * 0.08, ac.sampleRate);
        var data = buf.getChannelData(0);
        for (var s = 0; s < data.length; s++) data[s] = (Math.random() * 2 - 1) * 0.3;
        var src = ac.createBufferSource(), g = ac.createGain();
        var filt = ac.createBiquadFilter();
        filt.type = 'lowpass'; filt.frequency.value = cfg.freq;
        src.buffer = buf; src.connect(filt); filt.connect(g); g.connect(ac.destination);
        var t = now + sn * 0.12;
        g.gain.setValueAtTime(0.12, t); g.gain.exponentialRampToValueAtTime(0.001, t + 0.08);
        src.start(t);
      }
    }
    else if (cfg.type === 'click') {
      for (var ck = 0; ck < 3; ck++) {
        var o = ac.createOscillator(), g = ac.createGain();
        o.connect(g); g.connect(ac.destination); o.type = 'sine'; o.frequency.value = cfg.freq;
        var t = now + ck * 0.1;
        g.gain.setValueAtTime(0.2, t); g.gain.exponentialRampToValueAtTime(0.001, t + cfg.dur);
        o.start(t); o.stop(t + cfg.dur);
      }
    }
    else if (cfg.type === 'thump') {
      for (var th = 0; th < 3; th++) {
        var o = ac.createOscillator(), g = ac.createGain();
        o.connect(g); g.connect(ac.destination); o.type = 'sine'; o.frequency.value = cfg.freq;
        var t = now + th * 0.2;
        g.gain.setValueAtTime(0.25, t); g.gain.exponentialRampToValueAtTime(0.001, t + cfg.dur);
        o.start(t); o.stop(t + cfg.dur);
      }
    }

    var totalDur = cfg.type === 'howl' ? cfg.dur : cfg.type === 'bark' ? 0.6 : cfg.type === 'chitter' ? 0.8 : cfg.type === 'chirp' ? 0.8 : cfg.type === 'hoot' ? 1.1 : cfg.type === 'snuffle' ? 0.7 : cfg.type === 'click' ? 0.3 : cfg.type === 'thump' ? 0.6 : cfg.dur + 0.1;
    setTimeout(function() { btn.classList.remove('playing'); }, totalDur * 1000);
  } catch (e) {
    btn.classList.remove('playing');
  }
}

buildCards();

var sc = document.getElementById('scene');
for (var i = 0; i < 20; i++) {
  var f = document.createElement('div');
  f.className = 'firefly';
  f.style.left = (Math.random() * 100) + '%';
  f.style.top = (Math.random() * 100) + '%';
  f.style.setProperty('--dur', (3 + Math.random() * 5) + 's');
  f.style.setProperty('--dx', ((Math.random() - .5) * 100) + 'px');
  f.style.setProperty('--dy', ((Math.random() - .5) * 100) + 'px');
  f.style.animationDelay = (Math.random() * 5) + 's';
  sc.appendChild(f);
}
var leafEmojis = ['\uD83C\uDF43', '\uD83C\uDF42', '\uD83C\uDF41'];
for (var i = 0; i < 8; i++) {
  var l = document.createElement('div');
  l.className = 'leaf';
  l.textContent = leafEmojis[Math.floor(Math.random() * leafEmojis.length)];
  l.style.left = (Math.random() * 100) + '%';
  l.style.setProperty('--dur', (8 + Math.random() * 6) + 's');
  l.style.setProperty('--dx', ((Math.random() - .5) * 150) + 'px');
  l.style.animationDelay = (Math.random() * 10) + 's';
  sc.appendChild(l);
}

document.addEventListener('touchstart', function(e) {
  for (var i = 0; i < e.changedTouches.length; i++) {
    var t = e.changedTouches[i];
    var ring = document.createElement('div');
    ring.className = 'touch-ring';
    ring.style.left = t.clientX + 'px';
    ring.style.top = t.clientY + 'px';
    document.body.appendChild(ring);
    ring.addEventListener('animationend', function() { this.remove(); });
  }
}, { passive: true });
</script>
</body>
</html>
