'earth' ? 0x4a90e2 :
                               key === 'mars' ? 0xe27b58 :
                               key === 'jupiter' ? 0xd8ca9d :
                               key === 'saturn' ? 0xfad5a5 :
                               key === 'uranus' ? 0x4fd0e7 : 0x4166f5,
                        emissive: key === 'sun' ? 0xfdb813 : 0x000000,
                        emissiveIntensity: key === 'sun' ? 1.5 : 0,
                        metalness: 0.3,
                        roughness: 0.7
                    });
                    
                    const planet = new THREE.Mesh(geometry, material);
                    planet.position.x = data.distance;
                    planet.castShadow = true;
                    planet.receiveShadow = true;
                    planet.userData = { key, ...data };
                    
                    scene.add(planet);
                    planets[key] = planet;
                    planetMeshes.push(planet);
                    
                    // Add orbit ring
                    if (key !== 'sun') {
                        const orbitGeometry = new THREE.RingGeometry(data.distance - 0.5, data.distance + 0.5, 64);
                        const orbitMaterial = new THREE.MeshBasicMaterial({ 
                            color: 0x444444, 
                            side: THREE.DoubleSide,
                            transparent: true,
                            opacity: 0.2
                        });
                        const orbit = new THREE.Mesh(orbitGeometry, orbitMaterial);
                        orbit.rotation.x = Math.PI / 2;
                        scene.add(orbit);
                    }
                    
                    loadedCount++;
                    updateLoadingProgress();
                }
            );
        });

        // Mouse interaction
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        let isDragging = false;
        let previousMousePosition = { x: 0, y: 0 };
        let autoRotate = true;

        renderer.domElement.addEventListener('click', onPlanetClick);
        renderer.domElement.addEventListener('mousedown', onMouseDown);
        renderer.domElement.addEventListener('mousemove', onMouseMove);
        renderer.domElement.addEventListener('mouseup', onMouseUp);
        renderer.domElement.addEventListener('wheel', onWheel);

        function animateCameraToPlanet(planetPosition, planetSize) {
            autoRotate = false;
            isAnimatingCamera = true;
            
            const distance = planetSize * 3;
            const offsetX = planetPosition.x;
            const offsetZ = planetPosition.z + distance;
            const offsetY = planetPosition.y + planetSize;
            
            cameraTarget = { x: offsetX, y: offsetY, z: offsetZ };
            cameraLookAt = { x: planetPosition.x, y: planetPosition.y, z: planetPosition.z };
        }

        function onPlanetClick(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(planetMeshes, true);

            if (intersects.length > 0) {
                let planet = intersects[0].object;
                while (planet.parent && !planet.userData.key) {
                    planet = planet.parent;
                }
                
                const planetKey = planet.userData.key;
                
                document.querySelectorAll('.planet-item').forEach(item => {
                    if (item.getAttribute('data-planet') === planetKey) {
                        item.classList.add('active');
                    } else {
                        item.classList.remove('active');
                    }
                });
                
                updateInfoPanel(planet.userData);
                animateCameraToPlanet(planet.position, planet.userData.size);
            }
        }

        function onMouseDown(event) {
            isDragging = true;
            autoRotate = false;
            previousMousePosition = { x: event.clientX, y: event.clientY };
        }

        function onMouseMove(event) {
            if (isDragging) {
                const deltaX = event.clientX - previousMousePosition.x;
                const deltaY = event.clientY - previousMousePosition.y;

                camera.position.x += deltaX * 0.5;
                camera.position.y -= deltaY * 0.5;
                camera.lookAt(0, 0, 0);

                previousMousePosition = { x: event.clientX, y: event.clientY };
            }
        }

        function onMouseUp() {
            isDragging = false;
        }

        function onWheel(event) {
            event.preventDefault();
            const zoomSpeed = 5;
            const direction = event.deltaY > 0 ? 1 : -1;
            
            camera.position.z += direction * zoomSpeed;
            camera.position.z = Math.max(50, Math.min(camera.position.z, 500));
        }

        function updateInfoPanel(data) {
            const panel = document.getElementById('info-panel');
            panel.classList.remove('visible');
            
            setTimeout(() => {
                panel.innerHTML = `
                    <h2>${data.name}</h2>
                    <p>${data.description}</p>
                    ${data.facts.map(fact => `<div class="stat"><strong>${fact.split(':')[0]}:</strong> ${fact.split(':')[1]}</div>`).join('')}
                `;
                panel.classList.add('visible');
            }, 300);
        }
        
        // Menu functionality
        const menuToggle = document.getElementById('planet-menu-toggle');
        const planetMenu = document.getElementById('planet-menu');
        
        menuToggle.addEventListener('click', function() {
            this.classList.toggle('open');
            planetMenu.classList.toggle('open');
        });
        
        document.addEventListener('click', function(event) {
            if (!menuToggle.contains(event.target) && !planetMenu.contains(event.target)) {
                menuToggle.classList.remove('open');
                planetMenu.classList.remove('open');
            }
        });
        
        document.querySelectorAll('.planet-item').forEach(item => {
            item.addEventListener('click', function(e) {
                e.stopPropagation();
                const planetKey = this.getAttribute('data-planet');
                const planet = planets[planetKey];
                
                if (planet) {
                    document.querySelectorAll('.planet-item').forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    
                    updateInfoPanel(planet.userData);
                    animateCameraToPlanet(planet.position, planet.userData.size);
                    
                    setTimeout(() => {
                        menuToggle.classList.remove('open');
                        planetMenu.classList.remove('open');
                    }, 300);
                }
            });
        });

        // Controls
        document.getElementById('reset-view').addEventListener('click', () => {
            camera.position.set(0, 100, 200);
            cameraTarget = { x: 0, y: 100, z: 200 };
            cameraLookAt = { x: 0, y: 0, z: 0 };
            camera.lookAt(0, 0, 0);
            autoRotate = true;
            isAnimatingCamera = false;
        });

        document.getElementById('fullscreen-btn').addEventListener('click', () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        });

        // Animation loop
        let angle = 0;
        function animate() {
            requestAnimationFrame(animate);

            if (isAnimatingCamera) {
                camera.position.x += (cameraTarget.x - camera.position.x) * 0.05;
                camera.position.y += (cameraTarget.y - camera.position.y) * 0.05;
                camera.position.z += (cameraTarget.z - camera.position.z) * 0.05;
                
                camera.lookAt(cameraLookAt.x, cameraLookAt.y, cameraLookAt.z);
                
                const distanceToTarget = Math.sqrt(
                    Math.pow(camera.position.x - cameraTarget.x, 2) +
                    Math.pow(camera.position.y - cameraTarget.y, 2) +
                    Math.pow(camera.position.z - cameraTarget.z, 2)
                );
                
                if (distanceToTarget < 1) {
                    isAnimatingCamera = false;
                }
            }

            if (autoRotate && !isAnimatingCamera) {
                angle += 0.001;
                camera.position.x = Math.sin(angle) * 200;
                camera.position.z = Math.cos(angle) * 200;
                camera.lookAt(0, 0, 0);
            }

            // Rotate planets
            Object.entries(planets).forEach(([key, planet]) => {
                const data = planetData[key];
                
                // Orbit
                if (key !== 'sun') {
                    const orbitAngle = Date.now() * data.speed * 0.0001;
                    planet.position.x = Math.cos(orbitAngle) * data.distance;
                    planet.position.z = Math.sin(orbitAngle) * data.distance;
                }
                
                // Self rotation
                planet.rotation.y += 0.01;
            });

            renderer.render(scene, camera);
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        animate();
    </script>
</body>
                </html>